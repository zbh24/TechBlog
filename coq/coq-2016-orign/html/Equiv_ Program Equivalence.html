<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!-- saved from url=(0055)http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html -->
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<link href="./Equiv_ Program Equivalence_files/coqdoc.css" rel="stylesheet" type="text/css">
<title>Equiv: Program Equivalence</title>
<script type="text/javascript" src="./Equiv_ Program Equivalence_files/jquery-1.8.3.js"></script>
<script type="text/javascript" src="./Equiv_ Program Equivalence_files/main.js"></script>
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Equiv<span class="subtitle">Program Equivalence</span></h1>

<div class="code code-tight">
</div>

<div class="doc">

</div>
<div class="code code-tight">

<br>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/library/Coq.Bool.Bool.html#"><span class="id" type="library">Coq.Bool.Bool</span></a>.<br>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/library/Coq.Arith.Arith.html#"><span class="id" type="library">Coq.Arith.Arith</span></a>.<br>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/library/Coq.Arith.EqNat.html#"><span class="id" type="library">Coq.Arith.EqNat</span></a>.<br>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/library/Coq.omega.Omega.html#"><span class="id" type="library">Coq.omega.Omega</span></a>.<br>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/library/Coq.Lists.List.html#"><span class="id" type="library">Coq.Lists.List</span></a>.<br>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/library/Coq.Logic.FunctionalExtensionality.html#"><span class="id" type="library">Coq.Logic.FunctionalExtensionality</span></a>.<br>
<span class="id" type="keyword">Import</span> <span class="id" type="var">ListNotations</span>.<br>

<br>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/SfLib.html#"><span class="id" type="library">SfLib</span></a>.<br>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Maps.html#"><span class="id" type="library">Maps</span></a>.<br>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#"><span class="id" type="library">Imp</span></a>.<br>

<br>
</div>

<div class="doc">
<a name="lab363"></a><h3 class="section">Some general advice for working on exercises:</h3>


<div class="paragraph"> </div>

<ul class="doclist">
<li> Most of the Coq proofs we ask you to do are similar to proofs
      that we've provided.  Before starting to work on exercises
      problems, take the time to work through our proofs (both
      informally, on paper, and in Coq) and make sure you understand
      them in detail.  This will save you a lot of time.

<div class="paragraph"> </div>


</li>
<li> The Coq proofs we're doing now are sufficiently complicated that
      it is more or less impossible to complete them simply by random
      experimentation or "following your nose."  You need to start
      with an idea about why the property is true and how the proof is
      going to go.  The best way to do this is to write out at least a
      sketch of an informal proof on paper — one that intuitively
      convinces you of the truth of the theorem — before starting to
      work on the formal one.  Alternately, grab a friend and try to
      convince them that the theorem is true; then try to formalize
      your explanation.

<div class="paragraph"> </div>


</li>
<li> Use automation to save work!  Some of the proofs in this
      chapter's exercises are pretty long if you try to write out all
      the cases explicitly. 
</li>
</ul>

</div>
<div class="code code-tight">

<br>
</div>

<div class="doc">
<a name="lab364"></a><h1 class="section">Behavioral Equivalence</h1>

<div class="paragraph"> </div>

 In an earlier chapter, we investigated the correctness of a very
    simple program transformation: the <span class="inlinecode"><span class="id" type="var">optimize_0plus</span></span> function.  The
    programming language we were considering was the first version of
    the language of arithmetic expressions — with no variables — so
    in that setting it was very easy to define what it means for a
    program transformation to be correct: it should always yield a
    program that evaluates to the same number as the original.

<div class="paragraph"> </div>

    To go further and talk about the correctness of program
    transformations in the full Imp language, we need to consider the
    role of variables and state. 
</div>
<div class="code code-tight">

<br>
</div>

<div class="doc">
<a name="lab365"></a><h2 class="section">Definitions</h2>

<div class="paragraph"> </div>

 For <span class="inlinecode"><span class="id" type="var">aexp</span></span>s and <span class="inlinecode"><span class="id" type="var">bexp</span></span>s with variables, the definition we want is
    clear.  We say
    that two <span class="inlinecode"><span class="id" type="var">aexp</span></span>s or <span class="inlinecode"><span class="id" type="var">bexp</span></span>s are <i>behaviorally equivalent</i> if they
    evaluate to the same result <i>in every state</i>. 
</div>
<div class="code code-tight">

<br>
<span class="id" type="keyword">Definition</span> <a name="aequiv"><span class="id" type="definition">aequiv</span></a> (<span class="id" type="var">a<sub>1</sub></span> <span class="id" type="var">a<sub>2</sub></span> : <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#aexp"><span class="id" type="inductive">aexp</span></a>) : <span class="id" type="keyword">Prop</span> :=<br>
&nbsp;&nbsp;<span style="font-family: arial;">∀</span>(<span class="id" type="var">st</span>:<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#state"><span class="id" type="definition">state</span></a>),<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#aeval"><span class="id" type="definition">aeval</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#st"><span class="id" type="variable">st</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#a<sub>1</sub>"><span class="id" type="variable">a<sub>1</sub></span></a> = <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#aeval"><span class="id" type="definition">aeval</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#st"><span class="id" type="variable">st</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#a<sub>2</sub>"><span class="id" type="variable">a<sub>2</sub></span></a>.<br>

<br>
<span class="id" type="keyword">Definition</span> <a name="bequiv"><span class="id" type="definition">bequiv</span></a> (<span class="id" type="var">b<sub>1</sub></span> <span class="id" type="var">b<sub>2</sub></span> : <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#bexp"><span class="id" type="inductive">bexp</span></a>) : <span class="id" type="keyword">Prop</span> :=<br>
&nbsp;&nbsp;<span style="font-family: arial;">∀</span>(<span class="id" type="var">st</span>:<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#state"><span class="id" type="definition">state</span></a>),<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#beval"><span class="id" type="definition">beval</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#st"><span class="id" type="variable">st</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#b<sub>1</sub>"><span class="id" type="variable">b<sub>1</sub></span></a> = <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#beval"><span class="id" type="definition">beval</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#st"><span class="id" type="variable">st</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#b<sub>2</sub>"><span class="id" type="variable">b<sub>2</sub></span></a>.<br>

<br>
</div>

<div class="doc">
For commands, the situation is a little more subtle.  We can't
    simply say "two commands are behaviorally equivalent if they
    evaluate to the same ending state whenever they are started in the
    same initial state," because some commands, when run in some
    starting states, don't terminate in any final state at all!  What
    we need instead is this: two commands are behaviorally equivalent
    if, for any given starting state, they either both diverge or both
    terminate in the same final state.  A compact way to express this
    is "if the first one terminates in a particular state then so does
    the second, and vice versa." 
</div>
<div class="code code-tight">

<br>
<span class="id" type="keyword">Definition</span> <a name="cequiv"><span class="id" type="definition">cequiv</span></a> (<span class="id" type="var">c<sub>1</sub></span> <span class="id" type="var">c<sub>2</sub></span> : <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#com"><span class="id" type="inductive">com</span></a>) : <span class="id" type="keyword">Prop</span> :=<br>
&nbsp;&nbsp;<span style="font-family: arial;">∀</span>(<span class="id" type="var">st</span> <span class="id" type="var">st'</span> : <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#state"><span class="id" type="definition">state</span></a>),<br>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c<sub>1</sub>"><span class="id" type="variable">c<sub>1</sub></span></a> / <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#st"><span class="id" type="variable">st</span></a> <span style="font-family: arial;">⇓</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#st'"><span class="id" type="variable">st'</span></a>) <span style="font-family: arial;">↔</span> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c<sub>2</sub>"><span class="id" type="variable">c<sub>2</sub></span></a> / <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#st"><span class="id" type="variable">st</span></a> <span style="font-family: arial;">⇓</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#st'"><span class="id" type="variable">st'</span></a>).<br>

<br>
</div>

<div class="doc">
<a name="lab366"></a><h4 class="section">Exercise: 2 stars (equiv_classes)</h4>

<div class="paragraph"> </div>

 Given the following programs, group together those that are
    equivalent in Imp. Your answer should be given as a list of lists,
    where each sub-list represents a group of equivalent programs. For
    example, if you think programs (a) through (h) are all equivalent
    to each other, but not to (i), your answer should look like this:

<div class="paragraph"> </div>


<div class="paragraph"> </div>

<div class="code code-tight">
&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;[<span class="id" type="var">prog_a</span>;<span class="id" type="var">prog_b</span>;<span class="id" type="var">prog_c</span>;<span class="id" type="var">prog_d</span>;<span class="id" type="var">prog_e</span>;<span class="id" type="var">prog_f</span>;<span class="id" type="var">prog_g</span>;<span class="id" type="var">prog_h</span>]&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" type="var">prog_i</span>]&nbsp;]
<div class="paragraph"> </div>

</div>

<div class="paragraph"> </div>

    Write down your answer below in the definition of
    <span class="inlinecode"><span class="id" type="var">equiv_classes</span></span>. 
</div>
<div class="code code-tight">

<br>
<span class="id" type="keyword">Definition</span> <a name="prog_a"><span class="id" type="definition">prog_a</span></a> : <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#com"><span class="id" type="inductive">com</span></a> :=<br>
&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#::'WHILE'_x_'DO'_x_'END'"><span class="id" type="notation">WHILE</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BNot"><span class="id" type="constructor">BNot</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BLe"><span class="id" type="constructor">BLe</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AId"><span class="id" type="constructor">AId</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#X"><span class="id" type="definition">X</span></a>) (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> 0)) <span class="id" type="var">DO</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#X"><span class="id" type="definition">X</span></a> ::= <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#APlus"><span class="id" type="constructor">APlus</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AId"><span class="id" type="constructor">AId</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#X"><span class="id" type="definition">X</span></a>) (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> 1)<br>
&nbsp;&nbsp;<span class="id" type="var">END</span>.<br>

<br>
<span class="id" type="keyword">Definition</span> <a name="prog_b"><span class="id" type="definition">prog_b</span></a> : <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#com"><span class="id" type="inductive">com</span></a> :=<br>
&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#::'IFB'_x_'THEN'_x_'ELSE'_x_'FI'"><span class="id" type="notation">IFB</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BEq"><span class="id" type="constructor">BEq</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AId"><span class="id" type="constructor">AId</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#X"><span class="id" type="definition">X</span></a>) (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> 0) <span class="id" type="var">THEN</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#X"><span class="id" type="definition">X</span></a> ::= <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#APlus"><span class="id" type="constructor">APlus</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AId"><span class="id" type="constructor">AId</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#X"><span class="id" type="definition">X</span></a>) (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> 1);;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#Y"><span class="id" type="definition">Y</span></a> ::= <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> 1<br>
&nbsp;&nbsp;<span class="id" type="var">ELSE</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#Y"><span class="id" type="definition">Y</span></a> ::= <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> 0<br>
&nbsp;&nbsp;<span class="id" type="var">FI</span>;;<br>
&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#X"><span class="id" type="definition">X</span></a> ::= <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AMinus"><span class="id" type="constructor">AMinus</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AId"><span class="id" type="constructor">AId</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#X"><span class="id" type="definition">X</span></a>) (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AId"><span class="id" type="constructor">AId</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#Y"><span class="id" type="definition">Y</span></a>);;<br>
&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#Y"><span class="id" type="definition">Y</span></a> ::= <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> 0.<br>

<br>
<span class="id" type="keyword">Definition</span> <a name="prog_c"><span class="id" type="definition">prog_c</span></a> : <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#com"><span class="id" type="inductive">com</span></a> :=<br>
&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#::'SKIP'"><span class="id" type="notation">SKIP</span></a>.<br>

<br>
<span class="id" type="keyword">Definition</span> <a name="prog_d"><span class="id" type="definition">prog_d</span></a> : <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#com"><span class="id" type="inductive">com</span></a> :=<br>
&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#::'WHILE'_x_'DO'_x_'END'"><span class="id" type="notation">WHILE</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BNot"><span class="id" type="constructor">BNot</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BEq"><span class="id" type="constructor">BEq</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AId"><span class="id" type="constructor">AId</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#X"><span class="id" type="definition">X</span></a>) (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> 0)) <span class="id" type="var">DO</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#X"><span class="id" type="definition">X</span></a> ::= <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#APlus"><span class="id" type="constructor">APlus</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AMult"><span class="id" type="constructor">AMult</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AId"><span class="id" type="constructor">AId</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#X"><span class="id" type="definition">X</span></a>) (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AId"><span class="id" type="constructor">AId</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#Y"><span class="id" type="definition">Y</span></a>)) (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> 1)<br>
&nbsp;&nbsp;<span class="id" type="var">END</span>.<br>

<br>
<span class="id" type="keyword">Definition</span> <a name="prog_e"><span class="id" type="definition">prog_e</span></a> : <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#com"><span class="id" type="inductive">com</span></a> :=<br>
&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#Y"><span class="id" type="definition">Y</span></a> ::= <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> 0.<br>

<br>
<span class="id" type="keyword">Definition</span> <a name="prog_f"><span class="id" type="definition">prog_f</span></a> : <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#com"><span class="id" type="inductive">com</span></a> :=<br>
&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#Y"><span class="id" type="definition">Y</span></a> ::= <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#APlus"><span class="id" type="constructor">APlus</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AId"><span class="id" type="constructor">AId</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#X"><span class="id" type="definition">X</span></a>) (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> 1);;<br>
&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#::'WHILE'_x_'DO'_x_'END'"><span class="id" type="notation">WHILE</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BNot"><span class="id" type="constructor">BNot</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BEq"><span class="id" type="constructor">BEq</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AId"><span class="id" type="constructor">AId</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#X"><span class="id" type="definition">X</span></a>) (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AId"><span class="id" type="constructor">AId</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#Y"><span class="id" type="definition">Y</span></a>)) <span class="id" type="var">DO</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#Y"><span class="id" type="definition">Y</span></a> ::= <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#APlus"><span class="id" type="constructor">APlus</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AId"><span class="id" type="constructor">AId</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#X"><span class="id" type="definition">X</span></a>) (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> 1)<br>
&nbsp;&nbsp;<span class="id" type="var">END</span>.<br>

<br>
<span class="id" type="keyword">Definition</span> <a name="prog_g"><span class="id" type="definition">prog_g</span></a> : <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#com"><span class="id" type="inductive">com</span></a> :=<br>
&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#::'WHILE'_x_'DO'_x_'END'"><span class="id" type="notation">WHILE</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BTrue"><span class="id" type="constructor">BTrue</span></a> <span class="id" type="var">DO</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#::'SKIP'"><span class="id" type="notation">SKIP</span></a><br>
&nbsp;&nbsp;<span class="id" type="var">END</span>.<br>

<br>
<span class="id" type="keyword">Definition</span> <a name="prog_h"><span class="id" type="definition">prog_h</span></a> : <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#com"><span class="id" type="inductive">com</span></a> :=<br>
&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#::'WHILE'_x_'DO'_x_'END'"><span class="id" type="notation">WHILE</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BNot"><span class="id" type="constructor">BNot</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BEq"><span class="id" type="constructor">BEq</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AId"><span class="id" type="constructor">AId</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#X"><span class="id" type="definition">X</span></a>) (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AId"><span class="id" type="constructor">AId</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#X"><span class="id" type="definition">X</span></a>)) <span class="id" type="var">DO</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#X"><span class="id" type="definition">X</span></a> ::= <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#APlus"><span class="id" type="constructor">APlus</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AId"><span class="id" type="constructor">AId</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#X"><span class="id" type="definition">X</span></a>) (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> 1)<br>
&nbsp;&nbsp;<span class="id" type="var">END</span>.<br>

<br>
<span class="id" type="keyword">Definition</span> <a name="prog_i"><span class="id" type="definition">prog_i</span></a> : <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#com"><span class="id" type="inductive">com</span></a> :=<br>
&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#::'WHILE'_x_'DO'_x_'END'"><span class="id" type="notation">WHILE</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BNot"><span class="id" type="constructor">BNot</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BEq"><span class="id" type="constructor">BEq</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AId"><span class="id" type="constructor">AId</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#X"><span class="id" type="definition">X</span></a>) (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AId"><span class="id" type="constructor">AId</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#Y"><span class="id" type="definition">Y</span></a>)) <span class="id" type="var">DO</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#X"><span class="id" type="definition">X</span></a> ::= <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#APlus"><span class="id" type="constructor">APlus</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AId"><span class="id" type="constructor">AId</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#Y"><span class="id" type="definition">Y</span></a>) (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> 1)<br>
&nbsp;&nbsp;<span class="id" type="var">END</span>.<br>

<br>
<span class="id" type="keyword">Definition</span> <a name="equiv_classes"><span class="id" type="definition">equiv_classes</span></a> : <a class="idref" href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list"><span class="id" type="inductive">list</span></a> (<a class="idref" href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#list"><span class="id" type="inductive">list</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#com"><span class="id" type="inductive">com</span></a>) :=<br>
<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/SfLib.html#admit"><span class="id" type="axiom">admit</span></a>.<br>
</div>

<div class="doc">
<font size="-2">☐</font> 
</div>
<div class="code code-tight">

<br>
</div>

<div class="doc">
<a name="lab367"></a><h2 class="section">Examples</h2>

<div class="paragraph"> </div>

 Here are some simple examples of equivalences of arithmetic
    and boolean expressions. 
</div>
<div class="code code-tight">

<br>
<span class="id" type="keyword">Theorem</span> <a name="aequiv_example"><span class="id" type="lemma">aequiv_example</span></a>:<br>
&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#aequiv"><span class="id" type="definition">aequiv</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AMinus"><span class="id" type="constructor">AMinus</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AId"><span class="id" type="constructor">AId</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#X"><span class="id" type="definition">X</span></a>) (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AId"><span class="id" type="constructor">AId</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#X"><span class="id" type="definition">X</span></a>)) (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> 0).<br>
<div class="togglescript" id="proofcontrol1" onclick="toggleDisplay(&#39;proof1&#39;);toggleDisplay(&#39;proofcontrol1&#39;)"><span class="show"></span></div>
<div class="proofscript" id="proof1" onclick="toggleDisplay(&#39;proof1&#39;);toggleDisplay(&#39;proofcontrol1&#39;)">
<span class="id" type="keyword">Proof</span>.<br>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">st</span>. <span class="id" type="tactic">simpl</span>. <span class="id" type="tactic">omega</span>.<br>
<span class="id" type="keyword">Qed</span>.<br>
</div>

<br>
<span class="id" type="keyword">Theorem</span> <a name="bequiv_example"><span class="id" type="lemma">bequiv_example</span></a>:<br>
&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#bequiv"><span class="id" type="definition">bequiv</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BEq"><span class="id" type="constructor">BEq</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AMinus"><span class="id" type="constructor">AMinus</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AId"><span class="id" type="constructor">AId</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#X"><span class="id" type="definition">X</span></a>) (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AId"><span class="id" type="constructor">AId</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#X"><span class="id" type="definition">X</span></a>)) (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> 0)) <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BTrue"><span class="id" type="constructor">BTrue</span></a>.<br>
<div class="togglescript" id="proofcontrol2" onclick="toggleDisplay(&#39;proof2&#39;);toggleDisplay(&#39;proofcontrol2&#39;)"><span class="show"></span></div>
<div class="proofscript" id="proof2" onclick="toggleDisplay(&#39;proof2&#39;);toggleDisplay(&#39;proofcontrol2&#39;)">
<span class="id" type="keyword">Proof</span>.<br>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">st</span>. <span class="id" type="tactic">unfold</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#beval"><span class="id" type="definition">beval</span></a>.<br>
&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#aequiv_example"><span class="id" type="lemma">aequiv_example</span></a>. <span class="id" type="tactic">reflexivity</span>.<br>
<span class="id" type="keyword">Qed</span>.<br>
</div>

<br>
</div>

<div class="doc">
For examples of command equivalence, let's start by looking at
    some trivial program transformations involving <span class="inlinecode"><span class="id" type="var">SKIP</span></span>: 
</div>
<div class="code code-tight">

<br>
<span class="id" type="keyword">Theorem</span> <a name="skip_left"><span class="id" type="lemma">skip_left</span></a>: <span style="font-family: arial;">∀</span><span class="id" type="var">c</span>,<br>
&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#cequiv"><span class="id" type="definition">cequiv</span></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#::'SKIP'"><span class="id" type="notation">SKIP</span></a>;; <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c"><span class="id" type="variable">c</span></a>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c"><span class="id" type="variable">c</span></a>.<br>
<span class="id" type="keyword">Proof</span>.<br>
&nbsp;&nbsp;<span class="comment">(*&nbsp;WORKED&nbsp;IN&nbsp;CLASS&nbsp;*)</span><br>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">c</span> <span class="id" type="var">st</span> <span class="id" type="var">st'</span>.<br>
&nbsp;&nbsp;<span class="id" type="tactic">split</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">H</span>.<br>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;-&gt;&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>. <span class="id" type="tactic">subst</span>.<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">H<sub>2</sub></span>. <span class="id" type="tactic">subst</span>.<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">assumption</span>.<br>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;&lt;-&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#E_Seq"><span class="id" type="constructor">E_Seq</span></a> <span class="id" type="keyword">with</span> <span class="id" type="var">st</span>.<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#E_Skip"><span class="id" type="constructor">E_Skip</span></a>.<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">assumption</span>.<br>
<span class="id" type="keyword">Qed</span>.<br>

<br>
</div>

<div class="doc">
<a name="lab368"></a><h4 class="section">Exercise: 2 stars (skip_right)</h4>
 Prove that adding a <span class="inlinecode"><span class="id" type="var">SKIP</span></span> after a command results in an
    equivalent program 
</div>
<div class="code code-tight">

<br>
<span class="id" type="keyword">Theorem</span> <a name="skip_right"><span class="id" type="lemma">skip_right</span></a>: <span style="font-family: arial;">∀</span><span class="id" type="var">c</span>,<br>
&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#cequiv"><span class="id" type="definition">cequiv</span></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c"><span class="id" type="variable">c</span></a> ;; <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#::'SKIP'"><span class="id" type="notation">SKIP</span></a>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c"><span class="id" type="variable">c</span></a>.<br>
<span class="id" type="keyword">Proof</span>.<br>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" type="var">Admitted</span>.<br>
</div>

<div class="doc">
<font size="-2">☐</font> 
<div class="paragraph"> </div>

 Similarly, here is a simple transformations that optimizes <span class="inlinecode"><span class="id" type="var">IFB</span></span>
    commands: 
</div>
<div class="code code-tight">

<br>
<span class="id" type="keyword">Theorem</span> <a name="IFB_true_simple"><span class="id" type="lemma">IFB_true_simple</span></a>: <span style="font-family: arial;">∀</span><span class="id" type="var">c<sub>1</sub></span> <span class="id" type="var">c<sub>2</sub></span>,<br>
&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#cequiv"><span class="id" type="definition">cequiv</span></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#::'IFB'_x_'THEN'_x_'ELSE'_x_'FI'"><span class="id" type="notation">IFB</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BTrue"><span class="id" type="constructor">BTrue</span></a> <span class="id" type="var">THEN</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c<sub>1</sub>"><span class="id" type="variable">c<sub>1</sub></span></a> <span class="id" type="var">ELSE</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c<sub>2</sub>"><span class="id" type="variable">c<sub>2</sub></span></a> <span class="id" type="var">FI</span>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c<sub>1</sub>"><span class="id" type="variable">c<sub>1</sub></span></a>.<br>
<div class="togglescript" id="proofcontrol3" onclick="toggleDisplay(&#39;proof3&#39;);toggleDisplay(&#39;proofcontrol3&#39;)"><span class="show"></span></div>
<div class="proofscript" id="proof3" onclick="toggleDisplay(&#39;proof3&#39;);toggleDisplay(&#39;proofcontrol3&#39;)">
<span class="id" type="keyword">Proof</span>.<br>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">c<sub>1</sub></span> <span class="id" type="var">c<sub>2</sub></span>.<br>
&nbsp;&nbsp;<span class="id" type="tactic">split</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">H</span>.<br>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;-&gt;&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>. <span class="id" type="tactic">assumption</span>. <span class="id" type="tactic">inversion</span> <span class="id" type="var">H<sub>5</sub></span>.<br>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;&lt;-&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#E_IfTrue"><span class="id" type="constructor">E_IfTrue</span></a>. <span class="id" type="tactic">reflexivity</span>. <span class="id" type="tactic">assumption</span>. <span class="id" type="keyword">Qed</span>.<br>
</div>

<br>
</div>

<div class="doc">
Of course, few programmers would be tempted to write a conditional
    whose guard is literally <span class="inlinecode"><span class="id" type="var">BTrue</span></span>.  A more interesting case is when
    the guard is <i>equivalent</i> to true:

<div class="paragraph"> </div>

   <i>Theorem</i>: If <span class="inlinecode"><span class="id" type="var">b</span></span> is equivalent to <span class="inlinecode"><span class="id" type="var">BTrue</span></span>, then <span class="inlinecode"><span class="id" type="var">IFB</span></span> <span class="inlinecode"><span class="id" type="var">b</span></span> <span class="inlinecode"><span class="id" type="var">THEN</span></span> <span class="inlinecode"><span class="id" type="var">c<sub>1</sub></span></span>
   <span class="inlinecode"><span class="id" type="var">ELSE</span></span> <span class="inlinecode"><span class="id" type="var">c<sub>2</sub></span></span> <span class="inlinecode"><span class="id" type="var">FI</span></span> is equivalent to <span class="inlinecode"><span class="id" type="var">c<sub>1</sub></span></span>.

<div class="paragraph"> </div>

   <i>Proof</i>:

<div class="paragraph"> </div>

<ul class="doclist">
<li> (<span class="inlinecode"><span style="font-family: arial;">→</span></span>) We must show, for all <span class="inlinecode"><span class="id" type="var">st</span></span> and <span class="inlinecode"><span class="id" type="var">st'</span></span>, that if <span class="inlinecode"><span class="id" type="var">IFB</span></span> <span class="inlinecode"><span class="id" type="var">b</span></span>
       <span class="inlinecode"><span class="id" type="var">THEN</span></span> <span class="inlinecode"><span class="id" type="var">c<sub>1</sub></span></span> <span class="inlinecode"><span class="id" type="var">ELSE</span></span> <span class="inlinecode"><span class="id" type="var">c<sub>2</sub></span></span> <span class="inlinecode"><span class="id" type="var">FI</span></span> <span class="inlinecode">/</span> <span class="inlinecode"><span class="id" type="var">st</span></span> <span class="inlinecode"><span style="font-family: arial;">⇓</span></span> <span class="inlinecode"><span class="id" type="var">st'</span></span> then <span class="inlinecode"><span class="id" type="var">c<sub>1</sub></span></span> <span class="inlinecode">/</span> <span class="inlinecode"><span class="id" type="var">st</span></span> <span class="inlinecode"><span style="font-family: arial;">⇓</span></span> <span class="inlinecode"><span class="id" type="var">st'</span></span>.

<div class="paragraph"> </div>

       Proceed by cases on the rules that could possibly have been
       used to show <span class="inlinecode"><span class="id" type="var">IFB</span></span> <span class="inlinecode"><span class="id" type="var">b</span></span> <span class="inlinecode"><span class="id" type="var">THEN</span></span> <span class="inlinecode"><span class="id" type="var">c<sub>1</sub></span></span> <span class="inlinecode"><span class="id" type="var">ELSE</span></span> <span class="inlinecode"><span class="id" type="var">c<sub>2</sub></span></span> <span class="inlinecode"><span class="id" type="var">FI</span></span> <span class="inlinecode">/</span> <span class="inlinecode"><span class="id" type="var">st</span></span> <span class="inlinecode"><span style="font-family: arial;">⇓</span></span> <span class="inlinecode"><span class="id" type="var">st'</span></span>, namely
       <span class="inlinecode"><span class="id" type="var">E_IfTrue</span></span> and <span class="inlinecode"><span class="id" type="var">E_IfFalse</span></span>.

<div class="paragraph"> </div>

<ul class="doclist">
<li> Suppose the final rule rule in the derivation of <span class="inlinecode"><span class="id" type="var">IFB</span></span> <span class="inlinecode"><span class="id" type="var">b</span></span> <span class="inlinecode"><span class="id" type="var">THEN</span></span>
         <span class="inlinecode"><span class="id" type="var">c<sub>1</sub></span></span> <span class="inlinecode"><span class="id" type="var">ELSE</span></span> <span class="inlinecode"><span class="id" type="var">c<sub>2</sub></span></span> <span class="inlinecode"><span class="id" type="var">FI</span></span> <span class="inlinecode">/</span> <span class="inlinecode"><span class="id" type="var">st</span></span> <span class="inlinecode"><span style="font-family: arial;">⇓</span></span> <span class="inlinecode"><span class="id" type="var">st'</span></span> was <span class="inlinecode"><span class="id" type="var">E_IfTrue</span></span>.  We then have, by
         the premises of <span class="inlinecode"><span class="id" type="var">E_IfTrue</span></span>, that <span class="inlinecode"><span class="id" type="var">c<sub>1</sub></span></span> <span class="inlinecode">/</span> <span class="inlinecode"><span class="id" type="var">st</span></span> <span class="inlinecode"><span style="font-family: arial;">⇓</span></span> <span class="inlinecode"><span class="id" type="var">st'</span></span>.  This is
         exactly what we set out to prove.

<div class="paragraph"> </div>


</li>
<li> On the other hand, suppose the final rule in the derivation
         of <span class="inlinecode"><span class="id" type="var">IFB</span></span> <span class="inlinecode"><span class="id" type="var">b</span></span> <span class="inlinecode"><span class="id" type="var">THEN</span></span> <span class="inlinecode"><span class="id" type="var">c<sub>1</sub></span></span> <span class="inlinecode"><span class="id" type="var">ELSE</span></span> <span class="inlinecode"><span class="id" type="var">c<sub>2</sub></span></span> <span class="inlinecode"><span class="id" type="var">FI</span></span> <span class="inlinecode">/</span> <span class="inlinecode"><span class="id" type="var">st</span></span> <span class="inlinecode"><span style="font-family: arial;">⇓</span></span> <span class="inlinecode"><span class="id" type="var">st'</span></span> was <span class="inlinecode"><span class="id" type="var">E_IfFalse</span></span>.
         We then know that <span class="inlinecode"><span class="id" type="var">beval</span></span> <span class="inlinecode"><span class="id" type="var">st</span></span> <span class="inlinecode"><span class="id" type="var">b</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" type="var">false</span></span> and <span class="inlinecode"><span class="id" type="var">c<sub>2</sub></span></span> <span class="inlinecode">/</span> <span class="inlinecode"><span class="id" type="var">st</span></span> <span class="inlinecode"><span style="font-family: arial;">⇓</span></span> <span class="inlinecode"><span class="id" type="var">st'</span></span>.

<div class="paragraph"> </div>

         Recall that <span class="inlinecode"><span class="id" type="var">b</span></span> is equivalent to <span class="inlinecode"><span class="id" type="var">BTrue</span></span>, i.e., forall <span class="inlinecode"><span class="id" type="var">st</span></span>,
         <span class="inlinecode"><span class="id" type="var">beval</span></span> <span class="inlinecode"><span class="id" type="var">st</span></span> <span class="inlinecode"><span class="id" type="var">b</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" type="var">beval</span></span> <span class="inlinecode"><span class="id" type="var">st</span></span> <span class="inlinecode"><span class="id" type="var">BTrue</span></span>.  In particular, this means
         that <span class="inlinecode"><span class="id" type="var">beval</span></span> <span class="inlinecode"><span class="id" type="var">st</span></span> <span class="inlinecode"><span class="id" type="var">b</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" type="var">true</span></span>, since <span class="inlinecode"><span class="id" type="var">beval</span></span> <span class="inlinecode"><span class="id" type="var">st</span></span> <span class="inlinecode"><span class="id" type="var">BTrue</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" type="var">true</span></span>.  But
         this is a contradiction, since <span class="inlinecode"><span class="id" type="var">E_IfFalse</span></span> requires that
         <span class="inlinecode"><span class="id" type="var">beval</span></span> <span class="inlinecode"><span class="id" type="var">st</span></span> <span class="inlinecode"><span class="id" type="var">b</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" type="var">false</span></span>.  Thus, the final rule could not have
         been <span class="inlinecode"><span class="id" type="var">E_IfFalse</span></span>.

<div class="paragraph"> </div>


</li>
</ul>

</li>
<li> (<span class="inlinecode"><span style="font-family: arial;">←</span></span>) We must show, for all <span class="inlinecode"><span class="id" type="var">st</span></span> and <span class="inlinecode"><span class="id" type="var">st'</span></span>, that if <span class="inlinecode"><span class="id" type="var">c<sub>1</sub></span></span> <span class="inlinecode">/</span> <span class="inlinecode"><span class="id" type="var">st</span></span>
       <span class="inlinecode"><span style="font-family: arial;">⇓</span></span> <span class="inlinecode"><span class="id" type="var">st'</span></span> then <span class="inlinecode"><span class="id" type="var">IFB</span></span> <span class="inlinecode"><span class="id" type="var">b</span></span> <span class="inlinecode"><span class="id" type="var">THEN</span></span> <span class="inlinecode"><span class="id" type="var">c<sub>1</sub></span></span> <span class="inlinecode"><span class="id" type="var">ELSE</span></span> <span class="inlinecode"><span class="id" type="var">c<sub>2</sub></span></span> <span class="inlinecode"><span class="id" type="var">FI</span></span> <span class="inlinecode">/</span> <span class="inlinecode"><span class="id" type="var">st</span></span> <span class="inlinecode"><span style="font-family: arial;">⇓</span></span> <span class="inlinecode"><span class="id" type="var">st'</span></span>.

<div class="paragraph"> </div>

       Since <span class="inlinecode"><span class="id" type="var">b</span></span> is equivalent to <span class="inlinecode"><span class="id" type="var">BTrue</span></span>, we know that <span class="inlinecode"><span class="id" type="var">beval</span></span> <span class="inlinecode"><span class="id" type="var">st</span></span> <span class="inlinecode"><span class="id" type="var">b</span></span> =
       <span class="inlinecode"><span class="id" type="var">beval</span></span> <span class="inlinecode"><span class="id" type="var">st</span></span> <span class="inlinecode"><span class="id" type="var">BTrue</span></span> = <span class="inlinecode"><span class="id" type="var">true</span></span>.  Together with the assumption that
       <span class="inlinecode"><span class="id" type="var">c<sub>1</sub></span></span> <span class="inlinecode">/</span> <span class="inlinecode"><span class="id" type="var">st</span></span> <span class="inlinecode"><span style="font-family: arial;">⇓</span></span> <span class="inlinecode"><span class="id" type="var">st'</span></span>, we can apply <span class="inlinecode"><span class="id" type="var">E_IfTrue</span></span> to derive <span class="inlinecode"><span class="id" type="var">IFB</span></span> <span class="inlinecode"><span class="id" type="var">b</span></span> <span class="inlinecode"><span class="id" type="var">THEN</span></span>
       <span class="inlinecode"><span class="id" type="var">c<sub>1</sub></span></span> <span class="inlinecode"><span class="id" type="var">ELSE</span></span> <span class="inlinecode"><span class="id" type="var">c<sub>2</sub></span></span> <span class="inlinecode"><span class="id" type="var">FI</span></span> <span class="inlinecode">/</span> <span class="inlinecode"><span class="id" type="var">st</span></span> <span class="inlinecode"><span style="font-family: arial;">⇓</span></span> <span class="inlinecode"><span class="id" type="var">st'</span></span>.  <font size="-2">☐</font>

</li>
</ul>

<div class="paragraph"> </div>

   Here is the formal version of this proof: 
</div>
<div class="code code-tight">

<br>
<span class="id" type="keyword">Theorem</span> <a name="IFB_true"><span class="id" type="lemma">IFB_true</span></a>: <span style="font-family: arial;">∀</span><span class="id" type="var">b</span> <span class="id" type="var">c<sub>1</sub></span> <span class="id" type="var">c<sub>2</sub></span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#bequiv"><span class="id" type="definition">bequiv</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#b"><span class="id" type="variable">b</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BTrue"><span class="id" type="constructor">BTrue</span></a>  <span style="font-family: arial;">→</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#cequiv"><span class="id" type="definition">cequiv</span></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#::'IFB'_x_'THEN'_x_'ELSE'_x_'FI'"><span class="id" type="notation">IFB</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#b"><span class="id" type="variable">b</span></a> <span class="id" type="var">THEN</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c<sub>1</sub>"><span class="id" type="variable">c<sub>1</sub></span></a> <span class="id" type="var">ELSE</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c<sub>2</sub>"><span class="id" type="variable">c<sub>2</sub></span></a> <span class="id" type="var">FI</span>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c<sub>1</sub>"><span class="id" type="variable">c<sub>1</sub></span></a>.<br>
<span class="id" type="keyword">Proof</span>.<br>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">b</span> <span class="id" type="var">c<sub>1</sub></span> <span class="id" type="var">c<sub>2</sub></span> <span class="id" type="var">Hb</span>.<br>
&nbsp;&nbsp;<span class="id" type="tactic">split</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">H</span>.<br>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;-&gt;&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;b&nbsp;evaluates&nbsp;to&nbsp;true&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">assumption</span>.<br>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;b&nbsp;evaluates&nbsp;to&nbsp;false&nbsp;(contradiction)&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">unfold</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#bequiv"><span class="id" type="definition">bequiv</span></a> <span class="id" type="keyword">in</span> <span class="id" type="var">Hb</span>. <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Hb</span>.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Hb</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H<sub>5</sub></span>.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">H<sub>5</sub></span>.<br>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;&lt;-&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#E_IfTrue"><span class="id" type="constructor">E_IfTrue</span></a>; <span class="id" type="tactic">try</span> <span class="id" type="tactic">assumption</span>.<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">unfold</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#bequiv"><span class="id" type="definition">bequiv</span></a> <span class="id" type="keyword">in</span> <span class="id" type="var">Hb</span>. <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Hb</span>.<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Hb</span>. <span class="id" type="tactic">reflexivity</span>. <span class="id" type="keyword">Qed</span>.<br>

<br>
</div>

<div class="doc">
<a name="lab369"></a><h4 class="section">Exercise: 2 stars, recommended (IFB_false)</h4>

</div>
<div class="code code-space">
<span class="id" type="keyword">Theorem</span> <a name="IFB_false"><span class="id" type="lemma">IFB_false</span></a>: <span style="font-family: arial;">∀</span><span class="id" type="var">b</span> <span class="id" type="var">c<sub>1</sub></span> <span class="id" type="var">c<sub>2</sub></span>,<br>
&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#bequiv"><span class="id" type="definition">bequiv</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#b"><span class="id" type="variable">b</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BFalse"><span class="id" type="constructor">BFalse</span></a>  <span style="font-family: arial;">→</span><br>
&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#cequiv"><span class="id" type="definition">cequiv</span></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#::'IFB'_x_'THEN'_x_'ELSE'_x_'FI'"><span class="id" type="notation">IFB</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#b"><span class="id" type="variable">b</span></a> <span class="id" type="var">THEN</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c<sub>1</sub>"><span class="id" type="variable">c<sub>1</sub></span></a> <span class="id" type="var">ELSE</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c<sub>2</sub>"><span class="id" type="variable">c<sub>2</sub></span></a> <span class="id" type="var">FI</span>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c<sub>2</sub>"><span class="id" type="variable">c<sub>2</sub></span></a>.<br>
<span class="id" type="keyword">Proof</span>.<br>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" type="var">Admitted</span>.<br>
</div>

<div class="doc">
<font size="-2">☐</font> 
<div class="paragraph"> </div>

<a name="lab370"></a><h4 class="section">Exercise: 3 stars (swap_if_branches)</h4>
 Show that we can swap the branches of an IF by negating its
    condition 
</div>
<div class="code code-tight">

<br>
<span class="id" type="keyword">Theorem</span> <a name="swap_if_branches"><span class="id" type="lemma">swap_if_branches</span></a>: <span style="font-family: arial;">∀</span><span class="id" type="var">b</span> <span class="id" type="var">e<sub>1</sub></span> <span class="id" type="var">e<sub>2</sub></span>,<br>
&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#cequiv"><span class="id" type="definition">cequiv</span></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#::'IFB'_x_'THEN'_x_'ELSE'_x_'FI'"><span class="id" type="notation">IFB</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#b"><span class="id" type="variable">b</span></a> <span class="id" type="var">THEN</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#e<sub>1</sub>"><span class="id" type="variable">e<sub>1</sub></span></a> <span class="id" type="var">ELSE</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#e<sub>2</sub>"><span class="id" type="variable">e<sub>2</sub></span></a> <span class="id" type="var">FI</span>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#::'IFB'_x_'THEN'_x_'ELSE'_x_'FI'"><span class="id" type="notation">IFB</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BNot"><span class="id" type="constructor">BNot</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#b"><span class="id" type="variable">b</span></a> <span class="id" type="var">THEN</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#e<sub>2</sub>"><span class="id" type="variable">e<sub>2</sub></span></a> <span class="id" type="var">ELSE</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#e<sub>1</sub>"><span class="id" type="variable">e<sub>1</sub></span></a> <span class="id" type="var">FI</span>).<br>
<span class="id" type="keyword">Proof</span>.<br>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" type="var">Admitted</span>.<br>
</div>

<div class="doc">
<font size="-2">☐</font> 
<div class="paragraph"> </div>

 For <span class="inlinecode"><span class="id" type="var">WHILE</span></span> loops, we can give a similar pair of theorems.  A loop
    whose guard is equivalent to <span class="inlinecode"><span class="id" type="var">BFalse</span></span> is equivalent to <span class="inlinecode"><span class="id" type="var">SKIP</span></span>,
    while a loop whose guard is equivalent to <span class="inlinecode"><span class="id" type="var">BTrue</span></span> is equivalent to
    <span class="inlinecode"><span class="id" type="var">WHILE</span></span> <span class="inlinecode"><span class="id" type="var">BTrue</span></span> <span class="inlinecode"><span class="id" type="var">DO</span></span> <span class="inlinecode"><span class="id" type="var">SKIP</span></span> <span class="inlinecode"><span class="id" type="var">END</span></span> (or any other non-terminating program).
    The first of these facts is easy. 
</div>
<div class="code code-tight">

<br>
<span class="id" type="keyword">Theorem</span> <a name="WHILE_false"><span class="id" type="lemma">WHILE_false</span></a> : <span style="font-family: arial;">∀</span><span class="id" type="var">b</span> <span class="id" type="var">c</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#bequiv"><span class="id" type="definition">bequiv</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#b"><span class="id" type="variable">b</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BFalse"><span class="id" type="constructor">BFalse</span></a> <span style="font-family: arial;">→</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#cequiv"><span class="id" type="definition">cequiv</span></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#::'WHILE'_x_'DO'_x_'END'"><span class="id" type="notation">WHILE</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#b"><span class="id" type="variable">b</span></a> <span class="id" type="var">DO</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c"><span class="id" type="variable">c</span></a> <span class="id" type="var">END</span>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#::'SKIP'"><span class="id" type="notation">SKIP</span></a>.<br>
<div class="togglescript" id="proofcontrol4" onclick="toggleDisplay(&#39;proof4&#39;);toggleDisplay(&#39;proofcontrol4&#39;)"><span class="show"></span></div>
<div class="proofscript" id="proof4" onclick="toggleDisplay(&#39;proof4&#39;);toggleDisplay(&#39;proofcontrol4&#39;)">
<span class="id" type="keyword">Proof</span>.<br>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">b</span> <span class="id" type="var">c</span> <span class="id" type="var">Hb</span>. <span class="id" type="tactic">split</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">H</span>.<br>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;-&gt;&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;E_WhileEnd&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#E_Skip"><span class="id" type="constructor">E_Skip</span></a>.<br>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;E_WhileLoop&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Hb</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H<sub>2</sub></span>. <span class="id" type="tactic">inversion</span> <span class="id" type="var">H<sub>2</sub></span>.<br>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;&lt;-&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#E_WhileEnd"><span class="id" type="constructor">E_WhileEnd</span></a>.<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Hb</span>.<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">reflexivity</span>. <span class="id" type="keyword">Qed</span>.<br>
</div>

<br>
</div>

<div class="doc">
<a name="lab371"></a><h4 class="section">Exercise: 2 stars, advanced, optional (WHILE_false_informal)</h4>
 Write an informal proof of <span class="inlinecode"><span class="id" type="var">WHILE_false</span></span>.

<div class="paragraph"> </div>

<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span><br>
<font size="-2">☐</font>

<div class="paragraph"> </div>

 To prove the second fact, we need an auxiliary lemma stating that
    <span class="inlinecode"><span class="id" type="var">WHILE</span></span> loops whose guards are equivalent to <span class="inlinecode"><span class="id" type="var">BTrue</span></span> never
    terminate:

<div class="paragraph"> </div>

    <i>Lemma</i>: If <span class="inlinecode"><span class="id" type="var">b</span></span> is equivalent to <span class="inlinecode"><span class="id" type="var">BTrue</span></span>, then it cannot be the
    case that <span class="inlinecode">(<span class="id" type="var">WHILE</span></span> <span class="inlinecode"><span class="id" type="var">b</span></span> <span class="inlinecode"><span class="id" type="var">DO</span></span> <span class="inlinecode"><span class="id" type="var">c</span></span> <span class="inlinecode"><span class="id" type="var">END</span>)</span> <span class="inlinecode">/</span> <span class="inlinecode"><span class="id" type="var">st</span></span> <span class="inlinecode"><span style="font-family: arial;">⇓</span></span> <span class="inlinecode"><span class="id" type="var">st'</span></span>.

<div class="paragraph"> </div>

    <i>Proof</i>: Suppose that <span class="inlinecode">(<span class="id" type="var">WHILE</span></span> <span class="inlinecode"><span class="id" type="var">b</span></span> <span class="inlinecode"><span class="id" type="var">DO</span></span> <span class="inlinecode"><span class="id" type="var">c</span></span> <span class="inlinecode"><span class="id" type="var">END</span>)</span> <span class="inlinecode">/</span> <span class="inlinecode"><span class="id" type="var">st</span></span> <span class="inlinecode"><span style="font-family: arial;">⇓</span></span> <span class="inlinecode"><span class="id" type="var">st'</span></span>.  We show,
    by induction on a derivation of <span class="inlinecode">(<span class="id" type="var">WHILE</span></span> <span class="inlinecode"><span class="id" type="var">b</span></span> <span class="inlinecode"><span class="id" type="var">DO</span></span> <span class="inlinecode"><span class="id" type="var">c</span></span> <span class="inlinecode"><span class="id" type="var">END</span>)</span> <span class="inlinecode">/</span> <span class="inlinecode"><span class="id" type="var">st</span></span> <span class="inlinecode"><span style="font-family: arial;">⇓</span></span> <span class="inlinecode"><span class="id" type="var">st'</span></span>,
    that this assumption leads to a contradiction.

<div class="paragraph"> </div>

<ul class="doclist">
<li> Suppose <span class="inlinecode">(<span class="id" type="var">WHILE</span></span> <span class="inlinecode"><span class="id" type="var">b</span></span> <span class="inlinecode"><span class="id" type="var">DO</span></span> <span class="inlinecode"><span class="id" type="var">c</span></span> <span class="inlinecode"><span class="id" type="var">END</span>)</span> <span class="inlinecode">/</span> <span class="inlinecode"><span class="id" type="var">st</span></span> <span class="inlinecode"><span style="font-family: arial;">⇓</span></span> <span class="inlinecode"><span class="id" type="var">st'</span></span> is proved using rule
        <span class="inlinecode"><span class="id" type="var">E_WhileEnd</span></span>.  Then by assumption <span class="inlinecode"><span class="id" type="var">beval</span></span> <span class="inlinecode"><span class="id" type="var">st</span></span> <span class="inlinecode"><span class="id" type="var">b</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" type="var">false</span></span>.  But
        this contradicts the assumption that <span class="inlinecode"><span class="id" type="var">b</span></span> is equivalent to
        <span class="inlinecode"><span class="id" type="var">BTrue</span></span>.

<div class="paragraph"> </div>


</li>
<li> Suppose <span class="inlinecode">(<span class="id" type="var">WHILE</span></span> <span class="inlinecode"><span class="id" type="var">b</span></span> <span class="inlinecode"><span class="id" type="var">DO</span></span> <span class="inlinecode"><span class="id" type="var">c</span></span> <span class="inlinecode"><span class="id" type="var">END</span>)</span> <span class="inlinecode">/</span> <span class="inlinecode"><span class="id" type="var">st</span></span> <span class="inlinecode"><span style="font-family: arial;">⇓</span></span> <span class="inlinecode"><span class="id" type="var">st'</span></span> is proved using rule
        <span class="inlinecode"><span class="id" type="var">E_WhileLoop</span></span>.  Then we are given the induction hypothesis
        that <span class="inlinecode">(<span class="id" type="var">WHILE</span></span> <span class="inlinecode"><span class="id" type="var">b</span></span> <span class="inlinecode"><span class="id" type="var">DO</span></span> <span class="inlinecode"><span class="id" type="var">c</span></span> <span class="inlinecode"><span class="id" type="var">END</span>)</span> <span class="inlinecode">/</span> <span class="inlinecode"><span class="id" type="var">st</span></span> <span class="inlinecode"><span style="font-family: arial;">⇓</span></span> <span class="inlinecode"><span class="id" type="var">st'</span></span> is contradictory, which
        is exactly what we are trying to prove!

<div class="paragraph"> </div>


</li>
<li> Since these are the only rules that could have been used to
        prove <span class="inlinecode">(<span class="id" type="var">WHILE</span></span> <span class="inlinecode"><span class="id" type="var">b</span></span> <span class="inlinecode"><span class="id" type="var">DO</span></span> <span class="inlinecode"><span class="id" type="var">c</span></span> <span class="inlinecode"><span class="id" type="var">END</span>)</span> <span class="inlinecode">/</span> <span class="inlinecode"><span class="id" type="var">st</span></span> <span class="inlinecode"><span style="font-family: arial;">⇓</span></span> <span class="inlinecode"><span class="id" type="var">st'</span></span>, the other cases of
        the induction are immediately contradictory. <font size="-2">☐</font> 
</li>
</ul>

</div>
<div class="code code-tight">

<br>
<span class="id" type="keyword">Lemma</span> <a name="WHILE_true_nonterm"><span class="id" type="lemma">WHILE_true_nonterm</span></a> : <span style="font-family: arial;">∀</span><span class="id" type="var">b</span> <span class="id" type="var">c</span> <span class="id" type="var">st</span> <span class="id" type="var">st'</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#bequiv"><span class="id" type="definition">bequiv</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#b"><span class="id" type="variable">b</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BTrue"><span class="id" type="constructor">BTrue</span></a> <span style="font-family: arial;">→</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~( (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#::'WHILE'_x_'DO'_x_'END'"><span class="id" type="notation">WHILE</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#b"><span class="id" type="variable">b</span></a> <span class="id" type="var">DO</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c"><span class="id" type="variable">c</span></a> <span class="id" type="var">END</span>) / <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#st"><span class="id" type="variable">st</span></a> <span style="font-family: arial;">⇓</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#st'"><span class="id" type="variable">st'</span></a> ).<br>
<span class="id" type="keyword">Proof</span>.<br>
&nbsp;&nbsp;<span class="comment">(*&nbsp;WORKED&nbsp;IN&nbsp;CLASS&nbsp;*)</span><br>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">b</span> <span class="id" type="var">c</span> <span class="id" type="var">st</span> <span class="id" type="var">st'</span> <span class="id" type="var">Hb</span>.<br>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">H</span>.<br>
&nbsp;&nbsp;<span class="id" type="var">remember</span> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#::'WHILE'_x_'DO'_x_'END'"><span class="id" type="notation">WHILE</span></a> <span class="id" type="var">b</span> <span class="id" type="var">DO</span> <span class="id" type="var">c</span> <span class="id" type="var">END</span>) <span class="id" type="keyword">as</span> <span class="id" type="var">cw</span> <span class="id" type="var">eqn</span>:<span class="id" type="var">Heqcw</span>.<br>
&nbsp;&nbsp;<span class="id" type="tactic">induction</span> <span class="id" type="var">H</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Most&nbsp;rules&nbsp;don't&nbsp;apply,&nbsp;and&nbsp;we&nbsp;can&nbsp;rule&nbsp;them&nbsp;out<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;by&nbsp;inversion&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">Heqcw</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">Heqcw</span>.<br>
&nbsp;&nbsp;<span class="comment">(*&nbsp;The&nbsp;two&nbsp;interesting&nbsp;cases&nbsp;are&nbsp;the&nbsp;ones&nbsp;for&nbsp;WHILE&nbsp;loops:&nbsp;*)</span><br>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;E_WhileEnd&nbsp;*)</span> <span class="comment">(*&nbsp;contradictory&nbsp;--&nbsp;b&nbsp;is&nbsp;always&nbsp;true!&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">unfold</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#bequiv"><span class="id" type="definition">bequiv</span></a> <span class="id" type="keyword">in</span> <span class="id" type="var">Hb</span>.<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;<span class="inlinecode"><span class="id" type="tactic">rewrite</span></span>&nbsp;is&nbsp;able&nbsp;to&nbsp;instantiate&nbsp;the&nbsp;quantifier&nbsp;in&nbsp;<span class="inlinecode"><span class="id" type="var">st</span></span>&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Hb</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>. <span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>.<br>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;E_WhileLoop&nbsp;*)</span> <span class="comment">(*&nbsp;immediate&nbsp;from&nbsp;the&nbsp;IH&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">IHceval2</span>. <span class="id" type="tactic">reflexivity</span>. <span class="id" type="keyword">Qed</span>.<br>

<br>
</div>

<div class="doc">
<a name="lab372"></a><h4 class="section">Exercise: 2 stars, optional (WHILE_true_nonterm_informal)</h4>
 Explain what the lemma <span class="inlinecode"><span class="id" type="var">WHILE_true_nonterm</span></span> means in English.

<div class="paragraph"> </div>

<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span><br>
 <font size="-2">☐</font> 
<div class="paragraph"> </div>

<a name="lab373"></a><h4 class="section">Exercise: 2 stars, recommended (WHILE_true)</h4>
 Prove the following theorem. <i>Hint</i>: You'll want to use
    <span class="inlinecode"><span class="id" type="var">WHILE_true_nonterm</span></span> here. 
</div>
<div class="code code-tight">

<br>
<span class="id" type="keyword">Theorem</span> <a name="WHILE_true"><span class="id" type="lemma">WHILE_true</span></a>: <span style="font-family: arial;">∀</span><span class="id" type="var">b</span> <span class="id" type="var">c</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#bequiv"><span class="id" type="definition">bequiv</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#b"><span class="id" type="variable">b</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BTrue"><span class="id" type="constructor">BTrue</span></a>  <span style="font-family: arial;">→</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#cequiv"><span class="id" type="definition">cequiv</span></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#::'WHILE'_x_'DO'_x_'END'"><span class="id" type="notation">WHILE</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#b"><span class="id" type="variable">b</span></a> <span class="id" type="var">DO</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c"><span class="id" type="variable">c</span></a> <span class="id" type="var">END</span>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#::'WHILE'_x_'DO'_x_'END'"><span class="id" type="notation">WHILE</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BTrue"><span class="id" type="constructor">BTrue</span></a> <span class="id" type="var">DO</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#::'SKIP'"><span class="id" type="notation">SKIP</span></a> <span class="id" type="var">END</span>).<br>
<span class="id" type="keyword">Proof</span>.<br>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" type="var">Admitted</span>.<br>
</div>

<div class="doc">
<font size="-2">☐</font> 
</div>
<div class="code code-tight">

<br>
<span class="id" type="keyword">Theorem</span> <a name="loop_unrolling"><span class="id" type="lemma">loop_unrolling</span></a>: <span style="font-family: arial;">∀</span><span class="id" type="var">b</span> <span class="id" type="var">c</span>,<br>
&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#cequiv"><span class="id" type="definition">cequiv</span></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#::'WHILE'_x_'DO'_x_'END'"><span class="id" type="notation">WHILE</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#b"><span class="id" type="variable">b</span></a> <span class="id" type="var">DO</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c"><span class="id" type="variable">c</span></a> <span class="id" type="var">END</span>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#::'IFB'_x_'THEN'_x_'ELSE'_x_'FI'"><span class="id" type="notation">IFB</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#b"><span class="id" type="variable">b</span></a> <span class="id" type="var">THEN</span> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c"><span class="id" type="variable">c</span></a>;; <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#::'WHILE'_x_'DO'_x_'END'"><span class="id" type="notation">WHILE</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#b"><span class="id" type="variable">b</span></a> <span class="id" type="var">DO</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c"><span class="id" type="variable">c</span></a> <span class="id" type="var">END</span>) <span class="id" type="var">ELSE</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#::'SKIP'"><span class="id" type="notation">SKIP</span></a> <span class="id" type="var">FI</span>).<br>
<span class="id" type="keyword">Proof</span>.<br>
&nbsp;&nbsp;<span class="comment">(*&nbsp;WORKED&nbsp;IN&nbsp;CLASS&nbsp;*)</span><br>
<div class="togglescript" id="proofcontrol5" onclick="toggleDisplay(&#39;proof5&#39;);toggleDisplay(&#39;proofcontrol5&#39;)"><span class="show"></span></div>
<div class="proofscript" id="proof5" onclick="toggleDisplay(&#39;proof5&#39;);toggleDisplay(&#39;proofcontrol5&#39;)">
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">b</span> <span class="id" type="var">c</span> <span class="id" type="var">st</span> <span class="id" type="var">st'</span>.<br>
&nbsp;&nbsp;<span class="id" type="tactic">split</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">Hce</span>.<br>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;-&gt;&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">Hce</span>; <span class="id" type="tactic">subst</span>.<br>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;loop&nbsp;doesn't&nbsp;run&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#E_IfFalse"><span class="id" type="constructor">E_IfFalse</span></a>. <span class="id" type="tactic">assumption</span>. <span class="id" type="tactic">apply</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#E_Skip"><span class="id" type="constructor">E_Skip</span></a>.<br>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;loop&nbsp;runs&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#E_IfTrue"><span class="id" type="constructor">E_IfTrue</span></a>. <span class="id" type="tactic">assumption</span>.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#E_Seq"><span class="id" type="constructor">E_Seq</span></a> <span class="id" type="keyword">with</span> (<span class="id" type="var">st'</span> := <span class="id" type="var">st'0</span>). <span class="id" type="tactic">assumption</span>. <span class="id" type="tactic">assumption</span>.<br>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;&lt;-&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">Hce</span>; <span class="id" type="tactic">subst</span>.<br>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;loop&nbsp;runs&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">H<sub>5</sub></span>; <span class="id" type="tactic">subst</span>.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#E_WhileLoop"><span class="id" type="constructor">E_WhileLoop</span></a> <span class="id" type="keyword">with</span> (<span class="id" type="var">st'</span> := <span class="id" type="var">st'0</span>).<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">assumption</span>. <span class="id" type="tactic">assumption</span>. <span class="id" type="tactic">assumption</span>.<br>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;loop&nbsp;doesn't&nbsp;run&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">H<sub>5</sub></span>; <span class="id" type="tactic">subst</span>. <span class="id" type="tactic">apply</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#E_WhileEnd"><span class="id" type="constructor">E_WhileEnd</span></a>. <span class="id" type="tactic">assumption</span>. <span class="id" type="keyword">Qed</span>.<br>
</div>

<br>
</div>

<div class="doc">
<a name="lab374"></a><h4 class="section">Exercise: 2 stars, optional (seq_assoc)</h4>

</div>
<div class="code code-space">
<span class="id" type="keyword">Theorem</span> <a name="seq_assoc"><span class="id" type="lemma">seq_assoc</span></a> : <span style="font-family: arial;">∀</span><span class="id" type="var">c<sub>1</sub></span> <span class="id" type="var">c<sub>2</sub></span> <span class="id" type="var">c<sub>3</sub></span>,<br>
&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#cequiv"><span class="id" type="definition">cequiv</span></a> ((<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c<sub>1</sub>"><span class="id" type="variable">c<sub>1</sub></span></a>;;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c<sub>2</sub>"><span class="id" type="variable">c<sub>2</sub></span></a>);;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c<sub>3</sub>"><span class="id" type="variable">c<sub>3</sub></span></a>) (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c<sub>1</sub>"><span class="id" type="variable">c<sub>1</sub></span></a>;;(<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c<sub>2</sub>"><span class="id" type="variable">c<sub>2</sub></span></a>;;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c<sub>3</sub>"><span class="id" type="variable">c<sub>3</sub></span></a>)).<br>
<span class="id" type="keyword">Proof</span>.<br>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" type="var">Admitted</span>.<br>
</div>

<div class="doc">
<font size="-2">☐</font> 
<div class="paragraph"> </div>

 Proving program properties involving assignments is one place
    where the functional-extensionality axiom introduced in the
    <span class="inlinecode"><span class="id" type="var">Logic</span></span> chapter often comes in handy.  Here are an example and an
    exercise. 
</div>
<div class="code code-tight">
<span class="id" type="keyword">Theorem</span> <a name="identity_assignment"><span class="id" type="lemma">identity_assignment</span></a> : <span style="font-family: arial;">∀</span>(<span class="id" type="var">X</span>:<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Maps.html#id"><span class="id" type="inductive">id</span></a>),<br>
&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#cequiv"><span class="id" type="definition">cequiv</span></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#X"><span class="id" type="variable">X</span></a> ::= <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AId"><span class="id" type="constructor">AId</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#X"><span class="id" type="variable">X</span></a>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#::'SKIP'"><span class="id" type="notation">SKIP</span></a>.<br>
<span class="id" type="keyword">Proof</span>.<br>
<div class="togglescript" id="proofcontrol6" onclick="toggleDisplay(&#39;proof6&#39;);toggleDisplay(&#39;proofcontrol6&#39;)"><span class="show"></span></div>
<div class="proofscript" id="proof6" onclick="toggleDisplay(&#39;proof6&#39;);toggleDisplay(&#39;proofcontrol6&#39;)">
&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">intros</span>. <span class="id" type="tactic">split</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;-&gt;&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>. <span class="id" type="tactic">simpl</span>.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">replace</span> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Maps.html#t_update"><span class="id" type="definition">t_update</span></a> <span class="id" type="var">st</span> <span class="id" type="var">X</span> (<span class="id" type="var">st</span> <span class="id" type="var">X</span>)) <span class="id" type="keyword">with</span> <span class="id" type="var">st</span>.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">constructor</span>.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/library/Coq.Logic.FunctionalExtensionality.html#functional_extensionality"><span class="id" type="lemma">functional_extensionality</span></a>. <span class="id" type="tactic">intro</span>.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Maps.html#t_update_same"><span class="id" type="axiom">t_update_same</span></a>; <span class="id" type="tactic">reflexivity</span>.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;&lt;-&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">assert</span> (<span class="id" type="var">st'</span> = (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Maps.html#t_update"><span class="id" type="definition">t_update</span></a> <span class="id" type="var">st'</span> <span class="id" type="var">X</span> (<span class="id" type="var">st'</span> <span class="id" type="var">X</span>))).<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/library/Coq.Logic.FunctionalExtensionality.html#functional_extensionality"><span class="id" type="lemma">functional_extensionality</span></a>. <span class="id" type="tactic">intro</span>.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Maps.html#t_update_same"><span class="id" type="axiom">t_update_same</span></a>; <span class="id" type="tactic">reflexivity</span>.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H<sub>0</sub></span> <span class="id" type="tactic">at</span> 2.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">constructor</span>. <span class="id" type="tactic">reflexivity</span>.<br>
</div>
<span class="id" type="keyword">Qed</span>.<br>

<br>
</div>

<div class="doc">
<a name="lab375"></a><h4 class="section">Exercise: 2 stars, recommended (assign_aequiv)</h4>

</div>
<div class="code code-space">
<span class="id" type="keyword">Theorem</span> <a name="assign_aequiv"><span class="id" type="lemma">assign_aequiv</span></a> : <span style="font-family: arial;">∀</span><span class="id" type="var">X</span> <span class="id" type="var">e</span>,<br>
&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#aequiv"><span class="id" type="definition">aequiv</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AId"><span class="id" type="constructor">AId</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#X"><span class="id" type="variable">X</span></a>) <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#e"><span class="id" type="variable">e</span></a> <span style="font-family: arial;">→</span><br>
&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#cequiv"><span class="id" type="definition">cequiv</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#::'SKIP'"><span class="id" type="notation">SKIP</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#X"><span class="id" type="variable">X</span></a> ::= <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#e"><span class="id" type="variable">e</span></a>).<br>
<span class="id" type="keyword">Proof</span>.<br>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" type="var">Admitted</span>.<br>
</div>

<div class="doc">
<font size="-2">☐</font> 
</div>
<div class="code code-tight">

<br>
</div>

<div class="doc">
<a name="lab376"></a><h1 class="section">Properties of Behavioral Equivalence</h1>

<div class="paragraph"> </div>

 We now turn to developing some of the properties of the program
    equivalences we have defined. 
</div>
<div class="code code-tight">

<br>
</div>

<div class="doc">
<a name="lab377"></a><h2 class="section">Behavioral Equivalence is an Equivalence</h2>

<div class="paragraph"> </div>

 First, we verify that the equivalences on <span class="inlinecode"><span class="id" type="var">aexps</span></span>, <span class="inlinecode"><span class="id" type="var">bexps</span></span>, and
    <span class="inlinecode"><span class="id" type="var">com</span></span>s really are <i>equivalences</i> — i.e., that they are reflexive,
    symmetric, and transitive.  The proofs are all easy. 
</div>
<div class="code code-tight">

<br>
<span class="id" type="keyword">Lemma</span> <a name="refl_aequiv"><span class="id" type="lemma">refl_aequiv</span></a> : <span style="font-family: arial;">∀</span>(<span class="id" type="var">a</span> : <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#aexp"><span class="id" type="inductive">aexp</span></a>), <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#aequiv"><span class="id" type="definition">aequiv</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#a"><span class="id" type="variable">a</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#a"><span class="id" type="variable">a</span></a>.<br>
<div class="togglescript" id="proofcontrol7" onclick="toggleDisplay(&#39;proof7&#39;);toggleDisplay(&#39;proofcontrol7&#39;)"><span class="show"></span></div>
<div class="proofscript" id="proof7" onclick="toggleDisplay(&#39;proof7&#39;);toggleDisplay(&#39;proofcontrol7&#39;)">
<span class="id" type="keyword">Proof</span>.<br>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">st</span>. <span class="id" type="tactic">reflexivity</span>. <span class="id" type="keyword">Qed</span>.<br>
</div>

<br>
<span class="id" type="keyword">Lemma</span> <a name="sym_aequiv"><span class="id" type="lemma">sym_aequiv</span></a> : <span style="font-family: arial;">∀</span>(<span class="id" type="var">a<sub>1</sub></span> <span class="id" type="var">a<sub>2</sub></span> : <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#aexp"><span class="id" type="inductive">aexp</span></a>),<br>
&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#aequiv"><span class="id" type="definition">aequiv</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#a<sub>1</sub>"><span class="id" type="variable">a<sub>1</sub></span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#a<sub>2</sub>"><span class="id" type="variable">a<sub>2</sub></span></a> <span style="font-family: arial;">→</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#aequiv"><span class="id" type="definition">aequiv</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#a<sub>2</sub>"><span class="id" type="variable">a<sub>2</sub></span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#a<sub>1</sub>"><span class="id" type="variable">a<sub>1</sub></span></a>.<br>
<div class="togglescript" id="proofcontrol8" onclick="toggleDisplay(&#39;proof8&#39;);toggleDisplay(&#39;proofcontrol8&#39;)"><span class="show"></span></div>
<div class="proofscript" id="proof8" onclick="toggleDisplay(&#39;proof8&#39;);toggleDisplay(&#39;proofcontrol8&#39;)">
<span class="id" type="keyword">Proof</span>.<br>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">a<sub>1</sub></span> <span class="id" type="var">a<sub>2</sub></span> <span class="id" type="var">H</span>. <span class="id" type="tactic">intros</span> <span class="id" type="var">st</span>. <span class="id" type="tactic">symmetry</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>. <span class="id" type="keyword">Qed</span>.<br>
</div>

<br>
<span class="id" type="keyword">Lemma</span> <a name="trans_aequiv"><span class="id" type="lemma">trans_aequiv</span></a> : <span style="font-family: arial;">∀</span>(<span class="id" type="var">a<sub>1</sub></span> <span class="id" type="var">a<sub>2</sub></span> <span class="id" type="var">a<sub>3</sub></span> : <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#aexp"><span class="id" type="inductive">aexp</span></a>),<br>
&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#aequiv"><span class="id" type="definition">aequiv</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#a<sub>1</sub>"><span class="id" type="variable">a<sub>1</sub></span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#a<sub>2</sub>"><span class="id" type="variable">a<sub>2</sub></span></a> <span style="font-family: arial;">→</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#aequiv"><span class="id" type="definition">aequiv</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#a<sub>2</sub>"><span class="id" type="variable">a<sub>2</sub></span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#a<sub>3</sub>"><span class="id" type="variable">a<sub>3</sub></span></a> <span style="font-family: arial;">→</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#aequiv"><span class="id" type="definition">aequiv</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#a<sub>1</sub>"><span class="id" type="variable">a<sub>1</sub></span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#a<sub>3</sub>"><span class="id" type="variable">a<sub>3</sub></span></a>.<br>
<div class="togglescript" id="proofcontrol9" onclick="toggleDisplay(&#39;proof9&#39;);toggleDisplay(&#39;proofcontrol9&#39;)"><span class="show"></span></div>
<div class="proofscript" id="proof9" onclick="toggleDisplay(&#39;proof9&#39;);toggleDisplay(&#39;proofcontrol9&#39;)">
<span class="id" type="keyword">Proof</span>.<br>
&nbsp;&nbsp;<span class="id" type="tactic">unfold</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#aequiv"><span class="id" type="definition">aequiv</span></a>. <span class="id" type="tactic">intros</span> <span class="id" type="var">a<sub>1</sub></span> <span class="id" type="var">a<sub>2</sub></span> <span class="id" type="var">a<sub>3</sub></span> <span class="id" type="var">H<sub>12</sub></span> <span class="id" type="var">H<sub>23</sub></span> <span class="id" type="var">st</span>.<br>
&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">H<sub>12</sub></span> <span class="id" type="var">st</span>). <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">H<sub>23</sub></span> <span class="id" type="var">st</span>). <span class="id" type="tactic">reflexivity</span>. <span class="id" type="keyword">Qed</span>.<br>
</div>

<br>
<span class="id" type="keyword">Lemma</span> <a name="refl_bequiv"><span class="id" type="lemma">refl_bequiv</span></a> : <span style="font-family: arial;">∀</span>(<span class="id" type="var">b</span> : <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#bexp"><span class="id" type="inductive">bexp</span></a>), <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#bequiv"><span class="id" type="definition">bequiv</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#b"><span class="id" type="variable">b</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#b"><span class="id" type="variable">b</span></a>.<br>
<div class="togglescript" id="proofcontrol10" onclick="toggleDisplay(&#39;proof10&#39;);toggleDisplay(&#39;proofcontrol10&#39;)"><span class="show"></span></div>
<div class="proofscript" id="proof10" onclick="toggleDisplay(&#39;proof10&#39;);toggleDisplay(&#39;proofcontrol10&#39;)">
<span class="id" type="keyword">Proof</span>.<br>
&nbsp;&nbsp;<span class="id" type="tactic">unfold</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#bequiv"><span class="id" type="definition">bequiv</span></a>. <span class="id" type="tactic">intros</span> <span class="id" type="var">b</span> <span class="id" type="var">st</span>. <span class="id" type="tactic">reflexivity</span>. <span class="id" type="keyword">Qed</span>.<br>
</div>

<br>
<span class="id" type="keyword">Lemma</span> <a name="sym_bequiv"><span class="id" type="lemma">sym_bequiv</span></a> : <span style="font-family: arial;">∀</span>(<span class="id" type="var">b<sub>1</sub></span> <span class="id" type="var">b<sub>2</sub></span> : <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#bexp"><span class="id" type="inductive">bexp</span></a>),<br>
&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#bequiv"><span class="id" type="definition">bequiv</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#b<sub>1</sub>"><span class="id" type="variable">b<sub>1</sub></span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#b<sub>2</sub>"><span class="id" type="variable">b<sub>2</sub></span></a> <span style="font-family: arial;">→</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#bequiv"><span class="id" type="definition">bequiv</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#b<sub>2</sub>"><span class="id" type="variable">b<sub>2</sub></span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#b<sub>1</sub>"><span class="id" type="variable">b<sub>1</sub></span></a>.<br>
<div class="togglescript" id="proofcontrol11" onclick="toggleDisplay(&#39;proof11&#39;);toggleDisplay(&#39;proofcontrol11&#39;)"><span class="show"></span></div>
<div class="proofscript" id="proof11" onclick="toggleDisplay(&#39;proof11&#39;);toggleDisplay(&#39;proofcontrol11&#39;)">
<span class="id" type="keyword">Proof</span>.<br>
&nbsp;&nbsp;<span class="id" type="tactic">unfold</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#bequiv"><span class="id" type="definition">bequiv</span></a>. <span class="id" type="tactic">intros</span> <span class="id" type="var">b<sub>1</sub></span> <span class="id" type="var">b<sub>2</sub></span> <span class="id" type="var">H</span>. <span class="id" type="tactic">intros</span> <span class="id" type="var">st</span>. <span class="id" type="tactic">symmetry</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>. <span class="id" type="keyword">Qed</span>.<br>
</div>

<br>
<span class="id" type="keyword">Lemma</span> <a name="trans_bequiv"><span class="id" type="lemma">trans_bequiv</span></a> : <span style="font-family: arial;">∀</span>(<span class="id" type="var">b<sub>1</sub></span> <span class="id" type="var">b<sub>2</sub></span> <span class="id" type="var">b<sub>3</sub></span> : <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#bexp"><span class="id" type="inductive">bexp</span></a>),<br>
&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#bequiv"><span class="id" type="definition">bequiv</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#b<sub>1</sub>"><span class="id" type="variable">b<sub>1</sub></span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#b<sub>2</sub>"><span class="id" type="variable">b<sub>2</sub></span></a> <span style="font-family: arial;">→</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#bequiv"><span class="id" type="definition">bequiv</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#b<sub>2</sub>"><span class="id" type="variable">b<sub>2</sub></span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#b<sub>3</sub>"><span class="id" type="variable">b<sub>3</sub></span></a> <span style="font-family: arial;">→</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#bequiv"><span class="id" type="definition">bequiv</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#b<sub>1</sub>"><span class="id" type="variable">b<sub>1</sub></span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#b<sub>3</sub>"><span class="id" type="variable">b<sub>3</sub></span></a>.<br>
<div class="togglescript" id="proofcontrol12" onclick="toggleDisplay(&#39;proof12&#39;);toggleDisplay(&#39;proofcontrol12&#39;)"><span class="show"></span></div>
<div class="proofscript" id="proof12" onclick="toggleDisplay(&#39;proof12&#39;);toggleDisplay(&#39;proofcontrol12&#39;)">
<span class="id" type="keyword">Proof</span>.<br>
&nbsp;&nbsp;<span class="id" type="tactic">unfold</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#bequiv"><span class="id" type="definition">bequiv</span></a>. <span class="id" type="tactic">intros</span> <span class="id" type="var">b<sub>1</sub></span> <span class="id" type="var">b<sub>2</sub></span> <span class="id" type="var">b<sub>3</sub></span> <span class="id" type="var">H<sub>12</sub></span> <span class="id" type="var">H<sub>23</sub></span> <span class="id" type="var">st</span>.<br>
&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">H<sub>12</sub></span> <span class="id" type="var">st</span>). <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">H<sub>23</sub></span> <span class="id" type="var">st</span>). <span class="id" type="tactic">reflexivity</span>. <span class="id" type="keyword">Qed</span>.<br>
</div>

<br>
<span class="id" type="keyword">Lemma</span> <a name="refl_cequiv"><span class="id" type="lemma">refl_cequiv</span></a> : <span style="font-family: arial;">∀</span>(<span class="id" type="var">c</span> : <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#com"><span class="id" type="inductive">com</span></a>), <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#cequiv"><span class="id" type="definition">cequiv</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c"><span class="id" type="variable">c</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c"><span class="id" type="variable">c</span></a>.<br>
<div class="togglescript" id="proofcontrol13" onclick="toggleDisplay(&#39;proof13&#39;);toggleDisplay(&#39;proofcontrol13&#39;)"><span class="show"></span></div>
<div class="proofscript" id="proof13" onclick="toggleDisplay(&#39;proof13&#39;);toggleDisplay(&#39;proofcontrol13&#39;)">
<span class="id" type="keyword">Proof</span>.<br>
&nbsp;&nbsp;<span class="id" type="tactic">unfold</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#cequiv"><span class="id" type="definition">cequiv</span></a>. <span class="id" type="tactic">intros</span> <span class="id" type="var">c</span> <span class="id" type="var">st</span> <span class="id" type="var">st'</span>. <span class="id" type="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/library/Coq.Init.Logic.html#iff_refl"><span class="id" type="lemma">iff_refl</span></a>. <span class="id" type="keyword">Qed</span>.<br>
</div>

<br>
<span class="id" type="keyword">Lemma</span> <a name="sym_cequiv"><span class="id" type="lemma">sym_cequiv</span></a> : <span style="font-family: arial;">∀</span>(<span class="id" type="var">c<sub>1</sub></span> <span class="id" type="var">c<sub>2</sub></span> : <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#com"><span class="id" type="inductive">com</span></a>),<br>
&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#cequiv"><span class="id" type="definition">cequiv</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c<sub>1</sub>"><span class="id" type="variable">c<sub>1</sub></span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c<sub>2</sub>"><span class="id" type="variable">c<sub>2</sub></span></a> <span style="font-family: arial;">→</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#cequiv"><span class="id" type="definition">cequiv</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c<sub>2</sub>"><span class="id" type="variable">c<sub>2</sub></span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c<sub>1</sub>"><span class="id" type="variable">c<sub>1</sub></span></a>.<br>
<div class="togglescript" id="proofcontrol14" onclick="toggleDisplay(&#39;proof14&#39;);toggleDisplay(&#39;proofcontrol14&#39;)"><span class="show"></span></div>
<div class="proofscript" id="proof14" onclick="toggleDisplay(&#39;proof14&#39;);toggleDisplay(&#39;proofcontrol14&#39;)">
<span class="id" type="keyword">Proof</span>.<br>
&nbsp;&nbsp;<span class="id" type="tactic">unfold</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#cequiv"><span class="id" type="definition">cequiv</span></a>. <span class="id" type="tactic">intros</span> <span class="id" type="var">c<sub>1</sub></span> <span class="id" type="var">c<sub>2</sub></span> <span class="id" type="var">H</span> <span class="id" type="var">st</span> <span class="id" type="var">st'</span>.<br>
&nbsp;&nbsp;<span class="id" type="tactic">assert</span> (<span class="id" type="var">c<sub>1</sub></span> / <span class="id" type="var">st</span> <span style="font-family: arial;">⇓</span> <span class="id" type="var">st'</span> <span style="font-family: arial;">↔</span> <span class="id" type="var">c<sub>2</sub></span> / <span class="id" type="var">st</span> <span style="font-family: arial;">⇓</span> <span class="id" type="var">st'</span>) <span class="id" type="keyword">as</span> <span class="id" type="var">H'</span>.<br>
&nbsp;&nbsp;{ <span class="comment">(*&nbsp;Proof&nbsp;of&nbsp;assertion&nbsp;*)</span> <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>. }<br>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/library/Coq.Init.Logic.html#iff_sym"><span class="id" type="lemma">iff_sym</span></a>. <span class="id" type="tactic">assumption</span>.<br>
<span class="id" type="keyword">Qed</span>.<br>
</div>

<br>
<span class="id" type="keyword">Lemma</span> <a name="iff_trans"><span class="id" type="lemma">iff_trans</span></a> : <span style="font-family: arial;">∀</span>(<span class="id" type="var">P<sub>1</sub></span> <span class="id" type="var">P<sub>2</sub></span> <span class="id" type="var">P<sub>3</sub></span> : <span class="id" type="keyword">Prop</span>),<br>
&nbsp;&nbsp;(<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#P<sub>1</sub>"><span class="id" type="variable">P<sub>1</sub></span></a> <span style="font-family: arial;">↔</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#P<sub>2</sub>"><span class="id" type="variable">P<sub>2</sub></span></a>) <span style="font-family: arial;">→</span> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#P<sub>2</sub>"><span class="id" type="variable">P<sub>2</sub></span></a> <span style="font-family: arial;">↔</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#P<sub>3</sub>"><span class="id" type="variable">P<sub>3</sub></span></a>) <span style="font-family: arial;">→</span> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#P<sub>1</sub>"><span class="id" type="variable">P<sub>1</sub></span></a> <span style="font-family: arial;">↔</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#P<sub>3</sub>"><span class="id" type="variable">P<sub>3</sub></span></a>).<br>
<div class="togglescript" id="proofcontrol15" onclick="toggleDisplay(&#39;proof15&#39;);toggleDisplay(&#39;proofcontrol15&#39;)"><span class="show"></span></div>
<div class="proofscript" id="proof15" onclick="toggleDisplay(&#39;proof15&#39;);toggleDisplay(&#39;proofcontrol15&#39;)">
<span class="id" type="keyword">Proof</span>.<br>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">P<sub>1</sub></span> <span class="id" type="var">P<sub>2</sub></span> <span class="id" type="var">P<sub>3</sub></span> <span class="id" type="var">H<sub>12</sub></span> <span class="id" type="var">H<sub>23</sub></span>.<br>
&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">H<sub>12</sub></span>. <span class="id" type="tactic">inversion</span> <span class="id" type="var">H<sub>23</sub></span>.<br>
&nbsp;&nbsp;<span class="id" type="tactic">split</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">A</span>.<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">H<sub>1</sub></span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">A</span>.<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">H<sub>0</sub></span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">H<sub>2</sub></span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">A</span>. <span class="id" type="keyword">Qed</span>.<br>
</div>

<br>
<span class="id" type="keyword">Lemma</span> <a name="trans_cequiv"><span class="id" type="lemma">trans_cequiv</span></a> : <span style="font-family: arial;">∀</span>(<span class="id" type="var">c<sub>1</sub></span> <span class="id" type="var">c<sub>2</sub></span> <span class="id" type="var">c<sub>3</sub></span> : <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#com"><span class="id" type="inductive">com</span></a>),<br>
&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#cequiv"><span class="id" type="definition">cequiv</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c<sub>1</sub>"><span class="id" type="variable">c<sub>1</sub></span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c<sub>2</sub>"><span class="id" type="variable">c<sub>2</sub></span></a> <span style="font-family: arial;">→</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#cequiv"><span class="id" type="definition">cequiv</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c<sub>2</sub>"><span class="id" type="variable">c<sub>2</sub></span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c<sub>3</sub>"><span class="id" type="variable">c<sub>3</sub></span></a> <span style="font-family: arial;">→</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#cequiv"><span class="id" type="definition">cequiv</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c<sub>1</sub>"><span class="id" type="variable">c<sub>1</sub></span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c<sub>3</sub>"><span class="id" type="variable">c<sub>3</sub></span></a>.<br>
<div class="togglescript" id="proofcontrol16" onclick="toggleDisplay(&#39;proof16&#39;);toggleDisplay(&#39;proofcontrol16&#39;)"><span class="show"></span></div>
<div class="proofscript" id="proof16" onclick="toggleDisplay(&#39;proof16&#39;);toggleDisplay(&#39;proofcontrol16&#39;)">
<span class="id" type="keyword">Proof</span>.<br>
&nbsp;&nbsp;<span class="id" type="tactic">unfold</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#cequiv"><span class="id" type="definition">cequiv</span></a>. <span class="id" type="tactic">intros</span> <span class="id" type="var">c<sub>1</sub></span> <span class="id" type="var">c<sub>2</sub></span> <span class="id" type="var">c<sub>3</sub></span> <span class="id" type="var">H<sub>12</sub></span> <span class="id" type="var">H<sub>23</sub></span> <span class="id" type="var">st</span> <span class="id" type="var">st'</span>.<br>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#iff_trans"><span class="id" type="lemma">iff_trans</span></a> <span class="id" type="keyword">with</span> (<span class="id" type="var">c<sub>2</sub></span> / <span class="id" type="var">st</span> <span style="font-family: arial;">⇓</span> <span class="id" type="var">st'</span>). <span class="id" type="tactic">apply</span> <span class="id" type="var">H<sub>12</sub></span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">H<sub>23</sub></span>. <span class="id" type="keyword">Qed</span>.<br>
</div>

<br>
</div>

<div class="doc">
<a name="lab378"></a><h2 class="section">Behavioral Equivalence is a Congruence</h2>

<div class="paragraph"> </div>

 Less obviously, behavioral equivalence is also a <i>congruence</i>.
    That is, the equivalence of two subprograms implies the
    equivalence of the larger programs in which they are embedded:
<center><table class="infrule">
<tbody><tr class="infruleassumption">
  <td class="infrule">aequiv&nbsp;a<sub>1</sub>&nbsp;a<sub>1</sub>'</td>
  <td class="infrulenamecol" rowspan="3">
    &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">cequiv&nbsp;(i&nbsp;::=&nbsp;a<sub>1</sub>)&nbsp;(i&nbsp;::=&nbsp;a<sub>1</sub>')</td>
  <td></td>

</tr></tbody></table></center><center><table class="infrule">
<tbody><tr class="infruleassumption">
  <td class="infrule">cequiv&nbsp;c<sub>1</sub>&nbsp;c<sub>1</sub>'</td>
  <td></td>

</tr><tr class="infruleassumption">
  <td class="infrule">cequiv&nbsp;c<sub>2</sub>&nbsp;c<sub>2</sub>'</td>
  <td class="infrulenamecol" rowspan="3">
    &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">cequiv&nbsp;(c<sub>1</sub>;;c<sub>2</sub>)&nbsp;(c<sub>1</sub>';;c<sub>2</sub>')</td>
  <td></td>

</tr></tbody></table></center>    ...and so on for the other forms of commands.

<div class="paragraph"> </div>

    (Note that we are using the inference rule notation here not as
    part of a definition, but simply to write down some valid
    implications in a readable format. We prove these implications
    below.) 
<div class="paragraph"> </div>

 We will see a concrete example of why these congruence
    properties are important in the following section (in the proof of
    <span class="inlinecode"><span class="id" type="var">fold_constants_com_sound</span></span>), but the main idea is that they allow
    us to replace a small part of a large program with an equivalent
    small part and know that the whole large programs are equivalent
    <i>without</i> doing an explicit proof about the non-varying parts —
    i.e., the "proof burden" of a small change to a large program is
    proportional to the size of the change, not the program. 
</div>
<div class="code code-tight">

<br>
<span class="id" type="keyword">Theorem</span> <a name="CAss_congruence"><span class="id" type="lemma">CAss_congruence</span></a> : <span style="font-family: arial;">∀</span><span class="id" type="var">i</span> <span class="id" type="var">a<sub>1</sub></span> <span class="id" type="var">a<sub>1</sub>'</span>,<br>
&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#aequiv"><span class="id" type="definition">aequiv</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#a<sub>1</sub>"><span class="id" type="variable">a<sub>1</sub></span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#a<sub>1</sub>'"><span class="id" type="variable">a<sub>1</sub>'</span></a> <span style="font-family: arial;">→</span><br>
&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#cequiv"><span class="id" type="definition">cequiv</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#CAss"><span class="id" type="constructor">CAss</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#i"><span class="id" type="variable">i</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#a<sub>1</sub>"><span class="id" type="variable">a<sub>1</sub></span></a>) (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#CAss"><span class="id" type="constructor">CAss</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#i"><span class="id" type="variable">i</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#a<sub>1</sub>'"><span class="id" type="variable">a<sub>1</sub>'</span></a>).<br>
<div class="togglescript" id="proofcontrol17" onclick="toggleDisplay(&#39;proof17&#39;);toggleDisplay(&#39;proofcontrol17&#39;)"><span class="show"></span></div>
<div class="proofscript" id="proof17" onclick="toggleDisplay(&#39;proof17&#39;);toggleDisplay(&#39;proofcontrol17&#39;)">
<span class="id" type="keyword">Proof</span>.<br>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">i</span> <span class="id" type="var">a<sub>1</sub></span> <span class="id" type="var">a<sub>2</sub></span> <span class="id" type="var">Heqv</span> <span class="id" type="var">st</span> <span class="id" type="var">st'</span>.<br>
&nbsp;&nbsp;<span class="id" type="tactic">split</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">Hceval</span>.<br>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;-&gt;&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">Hceval</span>. <span class="id" type="tactic">subst</span>. <span class="id" type="tactic">apply</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#E_Ass"><span class="id" type="constructor">E_Ass</span></a>.<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Heqv</span>. <span class="id" type="tactic">reflexivity</span>.<br>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;&lt;-&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">Hceval</span>. <span class="id" type="tactic">subst</span>. <span class="id" type="tactic">apply</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#E_Ass"><span class="id" type="constructor">E_Ass</span></a>.<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Heqv</span>. <span class="id" type="tactic">reflexivity</span>. <span class="id" type="keyword">Qed</span>.<br>
</div>

<br>
</div>

<div class="doc">
The congruence property for loops is a little more interesting,
    since it requires induction.

<div class="paragraph"> </div>

    <i>Theorem</i>: Equivalence is a congruence for <span class="inlinecode"><span class="id" type="var">WHILE</span></span> — that is, if
    <span class="inlinecode"><span class="id" type="var">b<sub>1</sub></span></span> is equivalent to <span class="inlinecode"><span class="id" type="var">b<sub>1</sub>'</span></span> and <span class="inlinecode"><span class="id" type="var">c<sub>1</sub></span></span> is equivalent to <span class="inlinecode"><span class="id" type="var">c<sub>1</sub>'</span></span>, then
    <span class="inlinecode"><span class="id" type="var">WHILE</span></span> <span class="inlinecode"><span class="id" type="var">b<sub>1</sub></span></span> <span class="inlinecode"><span class="id" type="var">DO</span></span> <span class="inlinecode"><span class="id" type="var">c<sub>1</sub></span></span> <span class="inlinecode"><span class="id" type="var">END</span></span> is equivalent to <span class="inlinecode"><span class="id" type="var">WHILE</span></span> <span class="inlinecode"><span class="id" type="var">b<sub>1</sub>'</span></span> <span class="inlinecode"><span class="id" type="var">DO</span></span> <span class="inlinecode"><span class="id" type="var">c<sub>1</sub>'</span></span> <span class="inlinecode"><span class="id" type="var">END</span></span>.

<div class="paragraph"> </div>

    <i>Proof</i>: Suppose <span class="inlinecode"><span class="id" type="var">b<sub>1</sub></span></span> is equivalent to <span class="inlinecode"><span class="id" type="var">b<sub>1</sub>'</span></span> and <span class="inlinecode"><span class="id" type="var">c<sub>1</sub></span></span> is
    equivalent to <span class="inlinecode"><span class="id" type="var">c<sub>1</sub>'</span></span>.  We must show, for every <span class="inlinecode"><span class="id" type="var">st</span></span> and <span class="inlinecode"><span class="id" type="var">st'</span></span>, that
    <span class="inlinecode"><span class="id" type="var">WHILE</span></span> <span class="inlinecode"><span class="id" type="var">b<sub>1</sub></span></span> <span class="inlinecode"><span class="id" type="var">DO</span></span> <span class="inlinecode"><span class="id" type="var">c<sub>1</sub></span></span> <span class="inlinecode"><span class="id" type="var">END</span></span> <span class="inlinecode">/</span> <span class="inlinecode"><span class="id" type="var">st</span></span> <span class="inlinecode"><span style="font-family: arial;">⇓</span></span> <span class="inlinecode"><span class="id" type="var">st'</span></span> iff <span class="inlinecode"><span class="id" type="var">WHILE</span></span> <span class="inlinecode"><span class="id" type="var">b<sub>1</sub>'</span></span> <span class="inlinecode"><span class="id" type="var">DO</span></span> <span class="inlinecode"><span class="id" type="var">c<sub>1</sub>'</span></span> <span class="inlinecode"><span class="id" type="var">END</span></span> <span class="inlinecode">/</span> <span class="inlinecode"><span class="id" type="var">st</span></span>
    <span class="inlinecode"><span style="font-family: arial;">⇓</span></span> <span class="inlinecode"><span class="id" type="var">st'</span></span>.  We consider the two directions separately.

<div class="paragraph"> </div>

<ul class="doclist">
<li> (<span class="inlinecode"><span style="font-family: arial;">→</span></span>) We show that <span class="inlinecode"><span class="id" type="var">WHILE</span></span> <span class="inlinecode"><span class="id" type="var">b<sub>1</sub></span></span> <span class="inlinecode"><span class="id" type="var">DO</span></span> <span class="inlinecode"><span class="id" type="var">c<sub>1</sub></span></span> <span class="inlinecode"><span class="id" type="var">END</span></span> <span class="inlinecode">/</span> <span class="inlinecode"><span class="id" type="var">st</span></span> <span class="inlinecode"><span style="font-family: arial;">⇓</span></span> <span class="inlinecode"><span class="id" type="var">st'</span></span> implies
        <span class="inlinecode"><span class="id" type="var">WHILE</span></span> <span class="inlinecode"><span class="id" type="var">b<sub>1</sub>'</span></span> <span class="inlinecode"><span class="id" type="var">DO</span></span> <span class="inlinecode"><span class="id" type="var">c<sub>1</sub>'</span></span> <span class="inlinecode"><span class="id" type="var">END</span></span> <span class="inlinecode">/</span> <span class="inlinecode"><span class="id" type="var">st</span></span> <span class="inlinecode"><span style="font-family: arial;">⇓</span></span> <span class="inlinecode"><span class="id" type="var">st'</span></span>, by induction on a
        derivation of <span class="inlinecode"><span class="id" type="var">WHILE</span></span> <span class="inlinecode"><span class="id" type="var">b<sub>1</sub></span></span> <span class="inlinecode"><span class="id" type="var">DO</span></span> <span class="inlinecode"><span class="id" type="var">c<sub>1</sub></span></span> <span class="inlinecode"><span class="id" type="var">END</span></span> <span class="inlinecode">/</span> <span class="inlinecode"><span class="id" type="var">st</span></span> <span class="inlinecode"><span style="font-family: arial;">⇓</span></span> <span class="inlinecode"><span class="id" type="var">st'</span></span>.  The only
        nontrivial cases are when the final rule in the derivation is
        <span class="inlinecode"><span class="id" type="var">E_WhileEnd</span></span> or <span class="inlinecode"><span class="id" type="var">E_WhileLoop</span></span>.

<div class="paragraph"> </div>

<ul class="doclist">
<li> <span class="inlinecode"><span class="id" type="var">E_WhileEnd</span></span>: In this case, the form of the rule gives us
            <span class="inlinecode"><span class="id" type="var">beval</span></span> <span class="inlinecode"><span class="id" type="var">st</span></span> <span class="inlinecode"><span class="id" type="var">b<sub>1</sub></span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" type="var">false</span></span> and <span class="inlinecode"><span class="id" type="var">st</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" type="var">st'</span></span>.  But then, since
            <span class="inlinecode"><span class="id" type="var">b<sub>1</sub></span></span> and <span class="inlinecode"><span class="id" type="var">b<sub>1</sub>'</span></span> are equivalent, we have <span class="inlinecode"><span class="id" type="var">beval</span></span> <span class="inlinecode"><span class="id" type="var">st</span></span> <span class="inlinecode"><span class="id" type="var">b<sub>1</sub>'</span></span> <span class="inlinecode">=</span>
            <span class="inlinecode"><span class="id" type="var">false</span></span>, and <span class="inlinecode"><span class="id" type="var">E</span>-<span class="id" type="var">WhileEnd</span></span> applies, giving us <span class="inlinecode"><span class="id" type="var">WHILE</span></span> <span class="inlinecode"><span class="id" type="var">b<sub>1</sub>'</span></span> <span class="inlinecode"><span class="id" type="var">DO</span></span>
            <span class="inlinecode"><span class="id" type="var">c<sub>1</sub>'</span></span> <span class="inlinecode"><span class="id" type="var">END</span></span> <span class="inlinecode">/</span> <span class="inlinecode"><span class="id" type="var">st</span></span> <span class="inlinecode"><span style="font-family: arial;">⇓</span></span> <span class="inlinecode"><span class="id" type="var">st'</span></span>, as required.

<div class="paragraph"> </div>


</li>
<li> <span class="inlinecode"><span class="id" type="var">E_WhileLoop</span></span>: The form of the rule now gives us <span class="inlinecode"><span class="id" type="var">beval</span></span> <span class="inlinecode"><span class="id" type="var">st</span></span>
            <span class="inlinecode"><span class="id" type="var">b<sub>1</sub></span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" type="var">true</span></span>, with <span class="inlinecode"><span class="id" type="var">c<sub>1</sub></span></span> <span class="inlinecode">/</span> <span class="inlinecode"><span class="id" type="var">st</span></span> <span class="inlinecode"><span style="font-family: arial;">⇓</span></span> <span class="inlinecode"><span class="id" type="var">st'0</span></span> and <span class="inlinecode"><span class="id" type="var">WHILE</span></span> <span class="inlinecode"><span class="id" type="var">b<sub>1</sub></span></span> <span class="inlinecode"><span class="id" type="var">DO</span></span> <span class="inlinecode"><span class="id" type="var">c<sub>1</sub></span></span>
            <span class="inlinecode"><span class="id" type="var">END</span></span> <span class="inlinecode">/</span> <span class="inlinecode"><span class="id" type="var">st'0</span></span> <span class="inlinecode"><span style="font-family: arial;">⇓</span></span> <span class="inlinecode"><span class="id" type="var">st'</span></span> for some state <span class="inlinecode"><span class="id" type="var">st'0</span></span>, with the
            induction hypothesis <span class="inlinecode"><span class="id" type="var">WHILE</span></span> <span class="inlinecode"><span class="id" type="var">b<sub>1</sub>'</span></span> <span class="inlinecode"><span class="id" type="var">DO</span></span> <span class="inlinecode"><span class="id" type="var">c<sub>1</sub>'</span></span> <span class="inlinecode"><span class="id" type="var">END</span></span> <span class="inlinecode">/</span> <span class="inlinecode"><span class="id" type="var">st'0</span></span> <span class="inlinecode"><span style="font-family: arial;">⇓</span></span>
            <span class="inlinecode"><span class="id" type="var">st'</span></span>.

<div class="paragraph"> </div>

            Since <span class="inlinecode"><span class="id" type="var">c<sub>1</sub></span></span> and <span class="inlinecode"><span class="id" type="var">c<sub>1</sub>'</span></span> are equivalent, we know that <span class="inlinecode"><span class="id" type="var">c<sub>1</sub>'</span></span> <span class="inlinecode">/</span>
            <span class="inlinecode"><span class="id" type="var">st</span></span> <span class="inlinecode"><span style="font-family: arial;">⇓</span></span> <span class="inlinecode"><span class="id" type="var">st'0</span></span>.  And since <span class="inlinecode"><span class="id" type="var">b<sub>1</sub></span></span> and <span class="inlinecode"><span class="id" type="var">b<sub>1</sub>'</span></span> are equivalent, we
            have <span class="inlinecode"><span class="id" type="var">beval</span></span> <span class="inlinecode"><span class="id" type="var">st</span></span> <span class="inlinecode"><span class="id" type="var">b<sub>1</sub>'</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" type="var">true</span></span>.  Now <span class="inlinecode"><span class="id" type="var">E</span>-<span class="id" type="var">WhileLoop</span></span> applies,
            giving us <span class="inlinecode"><span class="id" type="var">WHILE</span></span> <span class="inlinecode"><span class="id" type="var">b<sub>1</sub>'</span></span> <span class="inlinecode"><span class="id" type="var">DO</span></span> <span class="inlinecode"><span class="id" type="var">c<sub>1</sub>'</span></span> <span class="inlinecode"><span class="id" type="var">END</span></span> <span class="inlinecode">/</span> <span class="inlinecode"><span class="id" type="var">st</span></span> <span class="inlinecode"><span style="font-family: arial;">⇓</span></span> <span class="inlinecode"><span class="id" type="var">st'</span></span>, as
            required.

<div class="paragraph"> </div>


</li>
</ul>

</li>
<li> (<span class="inlinecode"><span style="font-family: arial;">←</span></span>) Similar. <font size="-2">☐</font> 
</li>
</ul>

</div>
<div class="code code-tight">

<br>
<span class="id" type="keyword">Theorem</span> <a name="CWhile_congruence"><span class="id" type="lemma">CWhile_congruence</span></a> : <span style="font-family: arial;">∀</span><span class="id" type="var">b<sub>1</sub></span> <span class="id" type="var">b<sub>1</sub>'</span> <span class="id" type="var">c<sub>1</sub></span> <span class="id" type="var">c<sub>1</sub>'</span>,<br>
&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#bequiv"><span class="id" type="definition">bequiv</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#b<sub>1</sub>"><span class="id" type="variable">b<sub>1</sub></span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#b<sub>1</sub>'"><span class="id" type="variable">b<sub>1</sub>'</span></a> <span style="font-family: arial;">→</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#cequiv"><span class="id" type="definition">cequiv</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c<sub>1</sub>"><span class="id" type="variable">c<sub>1</sub></span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c<sub>1</sub>'"><span class="id" type="variable">c<sub>1</sub>'</span></a> <span style="font-family: arial;">→</span><br>
&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#cequiv"><span class="id" type="definition">cequiv</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#::'WHILE'_x_'DO'_x_'END'"><span class="id" type="notation">WHILE</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#b<sub>1</sub>"><span class="id" type="variable">b<sub>1</sub></span></a> <span class="id" type="var">DO</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c<sub>1</sub>"><span class="id" type="variable">c<sub>1</sub></span></a> <span class="id" type="var">END</span>) (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#::'WHILE'_x_'DO'_x_'END'"><span class="id" type="notation">WHILE</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#b<sub>1</sub>'"><span class="id" type="variable">b<sub>1</sub>'</span></a> <span class="id" type="var">DO</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c<sub>1</sub>'"><span class="id" type="variable">c<sub>1</sub>'</span></a> <span class="id" type="var">END</span>).<br>
<span class="id" type="keyword">Proof</span>.<br>
&nbsp;&nbsp;<span class="comment">(*&nbsp;WORKED&nbsp;IN&nbsp;CLASS&nbsp;*)</span><br>
&nbsp;&nbsp;<span class="id" type="tactic">unfold</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#bequiv"><span class="id" type="definition">bequiv</span></a>,<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#cequiv"><span class="id" type="definition">cequiv</span></a>.<br>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">b<sub>1</sub></span> <span class="id" type="var">b<sub>1</sub>'</span> <span class="id" type="var">c<sub>1</sub></span> <span class="id" type="var">c<sub>1</sub>'</span> <span class="id" type="var">Hb1e</span> <span class="id" type="var">Hc1e</span> <span class="id" type="var">st</span> <span class="id" type="var">st'</span>.<br>
&nbsp;&nbsp;<span class="id" type="tactic">split</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">Hce</span>.<br>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;-&gt;&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">remember</span> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#::'WHILE'_x_'DO'_x_'END'"><span class="id" type="notation">WHILE</span></a> <span class="id" type="var">b<sub>1</sub></span> <span class="id" type="var">DO</span> <span class="id" type="var">c<sub>1</sub></span> <span class="id" type="var">END</span>) <span class="id" type="keyword">as</span> <span class="id" type="var">cwhile</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">eqn</span>:<span class="id" type="var">Heqcwhile</span>.<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">induction</span> <span class="id" type="var">Hce</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">Heqcwhile</span>; <span class="id" type="tactic">subst</span>.<br>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;E_WhileEnd&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#E_WhileEnd"><span class="id" type="constructor">E_WhileEnd</span></a>. <span class="id" type="tactic">rewrite</span> <span style="font-family: arial;">←</span> <span class="id" type="var">Hb1e</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>.<br>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;E_WhileLoop&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#E_WhileLoop"><span class="id" type="constructor">E_WhileLoop</span></a> <span class="id" type="keyword">with</span> (<span class="id" type="var">st'</span> := <span class="id" type="var">st'</span>).<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;show&nbsp;loop&nbsp;runs&nbsp;*)</span> <span class="id" type="tactic">rewrite</span> <span style="font-family: arial;">←</span> <span class="id" type="var">Hb1e</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;body&nbsp;execution&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> (<span class="id" type="var">Hc1e</span> <span class="id" type="var">st</span> <span class="id" type="var">st'</span>). <span class="id" type="tactic">apply</span> <span class="id" type="var">Hce1</span>.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;subsequent&nbsp;loop&nbsp;execution&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">IHHce2</span>. <span class="id" type="tactic">reflexivity</span>.<br>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;&lt;-&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">remember</span> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#::'WHILE'_x_'DO'_x_'END'"><span class="id" type="notation">WHILE</span></a> <span class="id" type="var">b<sub>1</sub>'</span> <span class="id" type="var">DO</span> <span class="id" type="var">c<sub>1</sub>'</span> <span class="id" type="var">END</span>) <span class="id" type="keyword">as</span> <span class="id" type="var">c'while</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">eqn</span>:<span class="id" type="var">Heqc'while</span>.<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">induction</span> <span class="id" type="var">Hce</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">Heqc'while</span>; <span class="id" type="tactic">subst</span>.<br>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;E_WhileEnd&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#E_WhileEnd"><span class="id" type="constructor">E_WhileEnd</span></a>. <span class="id" type="tactic">rewrite</span> <span style="font-family: arial;">→</span> <span class="id" type="var">Hb1e</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>.<br>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;E_WhileLoop&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#E_WhileLoop"><span class="id" type="constructor">E_WhileLoop</span></a> <span class="id" type="keyword">with</span> (<span class="id" type="var">st'</span> := <span class="id" type="var">st'</span>).<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;show&nbsp;loop&nbsp;runs&nbsp;*)</span> <span class="id" type="tactic">rewrite</span> <span style="font-family: arial;">→</span> <span class="id" type="var">Hb1e</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;body&nbsp;execution&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> (<span class="id" type="var">Hc1e</span> <span class="id" type="var">st</span> <span class="id" type="var">st'</span>). <span class="id" type="tactic">apply</span> <span class="id" type="var">Hce1</span>.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;subsequent&nbsp;loop&nbsp;execution&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">IHHce2</span>. <span class="id" type="tactic">reflexivity</span>. <span class="id" type="keyword">Qed</span>.<br>

<br>
</div>

<div class="doc">
<a name="lab379"></a><h4 class="section">Exercise: 3 stars, optional (CSeq_congruence)</h4>

</div>
<div class="code code-space">
<span class="id" type="keyword">Theorem</span> <a name="CSeq_congruence"><span class="id" type="lemma">CSeq_congruence</span></a> : <span style="font-family: arial;">∀</span><span class="id" type="var">c<sub>1</sub></span> <span class="id" type="var">c<sub>1</sub>'</span> <span class="id" type="var">c<sub>2</sub></span> <span class="id" type="var">c<sub>2</sub>'</span>,<br>
&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#cequiv"><span class="id" type="definition">cequiv</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c<sub>1</sub>"><span class="id" type="variable">c<sub>1</sub></span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c<sub>1</sub>'"><span class="id" type="variable">c<sub>1</sub>'</span></a> <span style="font-family: arial;">→</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#cequiv"><span class="id" type="definition">cequiv</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c<sub>2</sub>"><span class="id" type="variable">c<sub>2</sub></span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c<sub>2</sub>'"><span class="id" type="variable">c<sub>2</sub>'</span></a> <span style="font-family: arial;">→</span><br>
&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#cequiv"><span class="id" type="definition">cequiv</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c<sub>1</sub>"><span class="id" type="variable">c<sub>1</sub></span></a>;;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c<sub>2</sub>"><span class="id" type="variable">c<sub>2</sub></span></a>) (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c<sub>1</sub>'"><span class="id" type="variable">c<sub>1</sub>'</span></a>;;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c<sub>2</sub>'"><span class="id" type="variable">c<sub>2</sub>'</span></a>).<br>
<span class="id" type="keyword">Proof</span>.<br>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" type="var">Admitted</span>.<br>
</div>

<div class="doc">
<font size="-2">☐</font> 
<div class="paragraph"> </div>

<a name="lab380"></a><h4 class="section">Exercise: 3 stars (CIf_congruence)</h4>

</div>
<div class="code code-space">
<span class="id" type="keyword">Theorem</span> <a name="CIf_congruence"><span class="id" type="lemma">CIf_congruence</span></a> : <span style="font-family: arial;">∀</span><span class="id" type="var">b</span> <span class="id" type="var">b'</span> <span class="id" type="var">c<sub>1</sub></span> <span class="id" type="var">c<sub>1</sub>'</span> <span class="id" type="var">c<sub>2</sub></span> <span class="id" type="var">c<sub>2</sub>'</span>,<br>
&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#bequiv"><span class="id" type="definition">bequiv</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#b"><span class="id" type="variable">b</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#b'"><span class="id" type="variable">b'</span></a> <span style="font-family: arial;">→</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#cequiv"><span class="id" type="definition">cequiv</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c<sub>1</sub>"><span class="id" type="variable">c<sub>1</sub></span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c<sub>1</sub>'"><span class="id" type="variable">c<sub>1</sub>'</span></a> <span style="font-family: arial;">→</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#cequiv"><span class="id" type="definition">cequiv</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c<sub>2</sub>"><span class="id" type="variable">c<sub>2</sub></span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c<sub>2</sub>'"><span class="id" type="variable">c<sub>2</sub>'</span></a> <span style="font-family: arial;">→</span><br>
&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#cequiv"><span class="id" type="definition">cequiv</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#::'IFB'_x_'THEN'_x_'ELSE'_x_'FI'"><span class="id" type="notation">IFB</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#b"><span class="id" type="variable">b</span></a> <span class="id" type="var">THEN</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c<sub>1</sub>"><span class="id" type="variable">c<sub>1</sub></span></a> <span class="id" type="var">ELSE</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c<sub>2</sub>"><span class="id" type="variable">c<sub>2</sub></span></a> <span class="id" type="var">FI</span>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#::'IFB'_x_'THEN'_x_'ELSE'_x_'FI'"><span class="id" type="notation">IFB</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#b'"><span class="id" type="variable">b'</span></a> <span class="id" type="var">THEN</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c<sub>1</sub>'"><span class="id" type="variable">c<sub>1</sub>'</span></a> <span class="id" type="var">ELSE</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c<sub>2</sub>'"><span class="id" type="variable">c<sub>2</sub>'</span></a> <span class="id" type="var">FI</span>).<br>
<span class="id" type="keyword">Proof</span>.<br>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" type="var">Admitted</span>.<br>
</div>

<div class="doc">
<font size="-2">☐</font> 
<div class="paragraph"> </div>

 For example, here are two equivalent programs and a proof of their
    equivalence... 
</div>
<div class="code code-tight">

<br>
<span class="id" type="keyword">Example</span> <a name="congruence_example"><span class="id" type="definition">congruence_example</span></a>:<br>
&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#cequiv"><span class="id" type="definition">cequiv</span></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Program&nbsp;1:&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#X"><span class="id" type="definition">X</span></a> ::= <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> 0;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#::'IFB'_x_'THEN'_x_'ELSE'_x_'FI'"><span class="id" type="notation">IFB</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BEq"><span class="id" type="constructor">BEq</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AId"><span class="id" type="constructor">AId</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#X"><span class="id" type="definition">X</span></a>) (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> 0))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">THEN</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#Y"><span class="id" type="definition">Y</span></a> ::= <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> 0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">ELSE</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#Y"><span class="id" type="definition">Y</span></a> ::= <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> 42<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">FI</span>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Program&nbsp;2:&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#X"><span class="id" type="definition">X</span></a> ::= <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> 0;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#::'IFB'_x_'THEN'_x_'ELSE'_x_'FI'"><span class="id" type="notation">IFB</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BEq"><span class="id" type="constructor">BEq</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AId"><span class="id" type="constructor">AId</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#X"><span class="id" type="definition">X</span></a>) (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> 0))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">THEN</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#Y"><span class="id" type="definition">Y</span></a> ::= <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AMinus"><span class="id" type="constructor">AMinus</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AId"><span class="id" type="constructor">AId</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#X"><span class="id" type="definition">X</span></a>) (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AId"><span class="id" type="constructor">AId</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#X"><span class="id" type="definition">X</span></a>)   <span class="comment">(*&nbsp;&lt;---&nbsp;changed&nbsp;here&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">ELSE</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#Y"><span class="id" type="definition">Y</span></a> ::= <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> 42<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">FI</span>).<br>
<span class="id" type="keyword">Proof</span>.<br>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#CSeq_congruence"><span class="id" type="axiom">CSeq_congruence</span></a>.<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#refl_cequiv"><span class="id" type="lemma">refl_cequiv</span></a>.<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#CIf_congruence"><span class="id" type="axiom">CIf_congruence</span></a>.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#refl_bequiv"><span class="id" type="lemma">refl_bequiv</span></a>.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#CAss_congruence"><span class="id" type="lemma">CAss_congruence</span></a>. <span class="id" type="tactic">unfold</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#aequiv"><span class="id" type="definition">aequiv</span></a>. <span class="id" type="tactic">simpl</span>.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">symmetry</span>. <span class="id" type="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/library/Coq.Arith.Minus.html#minus_diag"><span class="id" type="lemma">minus_diag</span></a>.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#refl_cequiv"><span class="id" type="lemma">refl_cequiv</span></a>.<br>
<span class="id" type="keyword">Qed</span>.<br>

<br>
</div>

<div class="doc">
<a name="lab381"></a><h1 class="section">Program Transformations</h1>

<div class="paragraph"> </div>

 A <i>program transformation</i> is a function that takes a program as
    input and produces some variant of the program as output.
    Compiler optimizations such as constant folding are a canonical
    example, but there are many others. 
<div class="paragraph"> </div>

 A program transformation is <i>sound</i> if it preserves the
    behavior of the original program. 
</div>
<div class="code code-tight">

<br>
<span class="id" type="keyword">Definition</span> <a name="atrans_sound"><span class="id" type="definition">atrans_sound</span></a> (<span class="id" type="var">atrans</span> : <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#aexp"><span class="id" type="inductive">aexp</span></a> <span style="font-family: arial;">→</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#aexp"><span class="id" type="inductive">aexp</span></a>) : <span class="id" type="keyword">Prop</span> :=<br>
&nbsp;&nbsp;<span style="font-family: arial;">∀</span>(<span class="id" type="var">a</span> : <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#aexp"><span class="id" type="inductive">aexp</span></a>),<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#aequiv"><span class="id" type="definition">aequiv</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#a"><span class="id" type="variable">a</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#atrans"><span class="id" type="variable">atrans</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#a"><span class="id" type="variable">a</span></a>).<br>

<br>
<span class="id" type="keyword">Definition</span> <a name="btrans_sound"><span class="id" type="definition">btrans_sound</span></a> (<span class="id" type="var">btrans</span> : <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#bexp"><span class="id" type="inductive">bexp</span></a> <span style="font-family: arial;">→</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#bexp"><span class="id" type="inductive">bexp</span></a>) : <span class="id" type="keyword">Prop</span> :=<br>
&nbsp;&nbsp;<span style="font-family: arial;">∀</span>(<span class="id" type="var">b</span> : <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#bexp"><span class="id" type="inductive">bexp</span></a>),<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#bequiv"><span class="id" type="definition">bequiv</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#b"><span class="id" type="variable">b</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#btrans"><span class="id" type="variable">btrans</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#b"><span class="id" type="variable">b</span></a>).<br>

<br>
<span class="id" type="keyword">Definition</span> <a name="ctrans_sound"><span class="id" type="definition">ctrans_sound</span></a> (<span class="id" type="var">ctrans</span> : <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#com"><span class="id" type="inductive">com</span></a> <span style="font-family: arial;">→</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#com"><span class="id" type="inductive">com</span></a>) : <span class="id" type="keyword">Prop</span> :=<br>
&nbsp;&nbsp;<span style="font-family: arial;">∀</span>(<span class="id" type="var">c</span> : <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#com"><span class="id" type="inductive">com</span></a>),<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#cequiv"><span class="id" type="definition">cequiv</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c"><span class="id" type="variable">c</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#ctrans"><span class="id" type="variable">ctrans</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c"><span class="id" type="variable">c</span></a>).<br>

<br>
</div>

<div class="doc">
<a name="lab382"></a><h2 class="section">The Constant-Folding Transformation</h2>

<div class="paragraph"> </div>

 An expression is <i>constant</i> when it contains no variable
    references.

<div class="paragraph"> </div>

    Constant folding is an optimization that finds constant
    expressions and replaces them by their values. 
</div>
<div class="code code-tight">

<br>
<span class="id" type="keyword">Fixpoint</span> <a name="fold_constants_aexp"><span class="id" type="definition">fold_constants_aexp</span></a> (<span class="id" type="var">a</span> : <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#aexp"><span class="id" type="inductive">aexp</span></a>) : <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#aexp"><span class="id" type="inductive">aexp</span></a> :=<br>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#a"><span class="id" type="variable">a</span></a> <span class="id" type="keyword">with</span><br>
&nbsp;&nbsp;| <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> <span class="id" type="var">n</span>       ⇒ <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> <span class="id" type="var">n</span><br>
&nbsp;&nbsp;| <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AId"><span class="id" type="constructor">AId</span></a> <span class="id" type="var">i</span>        ⇒ <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AId"><span class="id" type="constructor">AId</span></a> <span class="id" type="var">i</span><br>
&nbsp;&nbsp;| <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#APlus"><span class="id" type="constructor">APlus</span></a> <span class="id" type="var">a<sub>1</sub></span> <span class="id" type="var">a<sub>2</sub></span>  ⇒<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#fold_constants_aexp"><span class="id" type="definition">fold_constants_aexp</span></a> <span class="id" type="var">a<sub>1</sub></span>, <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#fold_constants_aexp"><span class="id" type="definition">fold_constants_aexp</span></a> <span class="id" type="var">a<sub>2</sub></span>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;| (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> <span class="id" type="var">n<sub>1</sub></span>, <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> <span class="id" type="var">n<sub>2</sub></span>) ⇒ <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> (<span class="id" type="var">n<sub>1</sub></span> + <span class="id" type="var">n<sub>2</sub></span>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id" type="var">a<sub>1</sub>'</span>, <span class="id" type="var">a<sub>2</sub>'</span>) ⇒ <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#APlus"><span class="id" type="constructor">APlus</span></a> <span class="id" type="var">a<sub>1</sub>'</span> <span class="id" type="var">a<sub>2</sub>'</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br>
&nbsp;&nbsp;| <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AMinus"><span class="id" type="constructor">AMinus</span></a> <span class="id" type="var">a<sub>1</sub></span> <span class="id" type="var">a<sub>2</sub></span> ⇒<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#fold_constants_aexp"><span class="id" type="definition">fold_constants_aexp</span></a> <span class="id" type="var">a<sub>1</sub></span>, <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#fold_constants_aexp"><span class="id" type="definition">fold_constants_aexp</span></a> <span class="id" type="var">a<sub>2</sub></span>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;| (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> <span class="id" type="var">n<sub>1</sub></span>, <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> <span class="id" type="var">n<sub>2</sub></span>) ⇒ <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> (<span class="id" type="var">n<sub>1</sub></span> - <span class="id" type="var">n<sub>2</sub></span>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id" type="var">a<sub>1</sub>'</span>, <span class="id" type="var">a<sub>2</sub>'</span>) ⇒ <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AMinus"><span class="id" type="constructor">AMinus</span></a> <span class="id" type="var">a<sub>1</sub>'</span> <span class="id" type="var">a<sub>2</sub>'</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br>
&nbsp;&nbsp;| <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AMult"><span class="id" type="constructor">AMult</span></a> <span class="id" type="var">a<sub>1</sub></span> <span class="id" type="var">a<sub>2</sub></span>  ⇒<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#fold_constants_aexp"><span class="id" type="definition">fold_constants_aexp</span></a> <span class="id" type="var">a<sub>1</sub></span>, <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#fold_constants_aexp"><span class="id" type="definition">fold_constants_aexp</span></a> <span class="id" type="var">a<sub>2</sub></span>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;| (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> <span class="id" type="var">n<sub>1</sub></span>, <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> <span class="id" type="var">n<sub>2</sub></span>) ⇒ <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> (<span class="id" type="var">n<sub>1</sub></span> * <span class="id" type="var">n<sub>2</sub></span>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id" type="var">a<sub>1</sub>'</span>, <span class="id" type="var">a<sub>2</sub>'</span>) ⇒ <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AMult"><span class="id" type="constructor">AMult</span></a> <span class="id" type="var">a<sub>1</sub>'</span> <span class="id" type="var">a<sub>2</sub>'</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br>

<br>
<span class="id" type="keyword">Example</span> <a name="fold_aexp_ex&lt;sub&gt;1&lt;/sub&gt;"><span class="id" type="definition">fold_aexp_ex<sub>1</sub></span></a> :<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#fold_constants_aexp"><span class="id" type="definition">fold_constants_aexp</span></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AMult"><span class="id" type="constructor">AMult</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#APlus"><span class="id" type="constructor">APlus</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> 1) (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> 2)) (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AId"><span class="id" type="constructor">AId</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#X"><span class="id" type="definition">X</span></a>))<br>
&nbsp;&nbsp;= <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AMult"><span class="id" type="constructor">AMult</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> 3) (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AId"><span class="id" type="constructor">AId</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#X"><span class="id" type="definition">X</span></a>).<br>
<div class="togglescript" id="proofcontrol18" onclick="toggleDisplay(&#39;proof18&#39;);toggleDisplay(&#39;proofcontrol18&#39;)"><span class="show"></span></div>
<div class="proofscript" id="proof18" onclick="toggleDisplay(&#39;proof18&#39;);toggleDisplay(&#39;proofcontrol18&#39;)">
<span class="id" type="keyword">Proof</span>. <span class="id" type="tactic">reflexivity</span>. <span class="id" type="keyword">Qed</span>.<br>
</div>

<br>
</div>

<div class="doc">
Note that this version of constant folding doesn't eliminate
    trivial additions, etc. — we are focusing attention on a single
    optimization for the sake of simplicity.  It is not hard to
    incorporate other ways of simplifying expressions; the definitions
    and proofs just get longer. 
</div>
<div class="code code-tight">

<br>
<span class="id" type="keyword">Example</span> <a name="fold_aexp_ex&lt;sub&gt;2&lt;/sub&gt;"><span class="id" type="definition">fold_aexp_ex<sub>2</sub></span></a> :<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#fold_constants_aexp"><span class="id" type="definition">fold_constants_aexp</span></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AMinus"><span class="id" type="constructor">AMinus</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AId"><span class="id" type="constructor">AId</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#X"><span class="id" type="definition">X</span></a>) (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#APlus"><span class="id" type="constructor">APlus</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AMult"><span class="id" type="constructor">AMult</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> 0) (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> 6))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AId"><span class="id" type="constructor">AId</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#Y"><span class="id" type="definition">Y</span></a>)))<br>
&nbsp;&nbsp;= <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AMinus"><span class="id" type="constructor">AMinus</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AId"><span class="id" type="constructor">AId</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#X"><span class="id" type="definition">X</span></a>) (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#APlus"><span class="id" type="constructor">APlus</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> 0) (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AId"><span class="id" type="constructor">AId</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#Y"><span class="id" type="definition">Y</span></a>)).<br>
<div class="togglescript" id="proofcontrol19" onclick="toggleDisplay(&#39;proof19&#39;);toggleDisplay(&#39;proofcontrol19&#39;)"><span class="show"></span></div>
<div class="proofscript" id="proof19" onclick="toggleDisplay(&#39;proof19&#39;);toggleDisplay(&#39;proofcontrol19&#39;)">
<span class="id" type="keyword">Proof</span>. <span class="id" type="tactic">reflexivity</span>. <span class="id" type="keyword">Qed</span>.<br>
</div>

<br>
</div>

<div class="doc">
Not only can we lift <span class="inlinecode"><span class="id" type="var">fold_constants_aexp</span></span> to <span class="inlinecode"><span class="id" type="var">bexp</span></span>s (in the
    <span class="inlinecode"><span class="id" type="var">BEq</span></span> and <span class="inlinecode"><span class="id" type="var">BLe</span></span> cases), we can also find constant <i>boolean</i>
    expressions and reduce them in-place. 
</div>
<div class="code code-tight">

<br>
<span class="id" type="keyword">Fixpoint</span> <a name="fold_constants_bexp"><span class="id" type="definition">fold_constants_bexp</span></a> (<span class="id" type="var">b</span> : <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#bexp"><span class="id" type="inductive">bexp</span></a>) : <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#bexp"><span class="id" type="inductive">bexp</span></a> :=<br>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#b"><span class="id" type="variable">b</span></a> <span class="id" type="keyword">with</span><br>
&nbsp;&nbsp;| <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BTrue"><span class="id" type="constructor">BTrue</span></a>        ⇒ <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BTrue"><span class="id" type="constructor">BTrue</span></a><br>
&nbsp;&nbsp;| <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BFalse"><span class="id" type="constructor">BFalse</span></a>       ⇒ <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BFalse"><span class="id" type="constructor">BFalse</span></a><br>
&nbsp;&nbsp;| <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BEq"><span class="id" type="constructor">BEq</span></a> <span class="id" type="var">a<sub>1</sub></span> <span class="id" type="var">a<sub>2</sub></span>  ⇒<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#fold_constants_aexp"><span class="id" type="definition">fold_constants_aexp</span></a> <span class="id" type="var">a<sub>1</sub></span>, <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#fold_constants_aexp"><span class="id" type="definition">fold_constants_aexp</span></a> <span class="id" type="var">a<sub>2</sub></span>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;| (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> <span class="id" type="var">n<sub>1</sub></span>, <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> <span class="id" type="var">n<sub>2</sub></span>) ⇒<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <a class="idref" href="http://coq.inria.fr/library/Coq.Arith.EqNat.html#beq_nat"><span class="id" type="definition">beq_nat</span></a> <span class="id" type="var">n<sub>1</sub></span> <span class="id" type="var">n<sub>2</sub></span> <span class="id" type="keyword">then</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BTrue"><span class="id" type="constructor">BTrue</span></a> <span class="id" type="keyword">else</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BFalse"><span class="id" type="constructor">BFalse</span></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id" type="var">a<sub>1</sub>'</span>, <span class="id" type="var">a<sub>2</sub>'</span>) ⇒<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BEq"><span class="id" type="constructor">BEq</span></a> <span class="id" type="var">a<sub>1</sub>'</span> <span class="id" type="var">a<sub>2</sub>'</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br>
&nbsp;&nbsp;| <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BLe"><span class="id" type="constructor">BLe</span></a> <span class="id" type="var">a<sub>1</sub></span> <span class="id" type="var">a<sub>2</sub></span>  ⇒<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#fold_constants_aexp"><span class="id" type="definition">fold_constants_aexp</span></a> <span class="id" type="var">a<sub>1</sub></span>, <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#fold_constants_aexp"><span class="id" type="definition">fold_constants_aexp</span></a> <span class="id" type="var">a<sub>2</sub></span>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;| (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> <span class="id" type="var">n<sub>1</sub></span>, <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> <span class="id" type="var">n<sub>2</sub></span>) ⇒<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <a class="idref" href="http://coq.inria.fr/library/Coq.Arith.Compare_dec.html#leb"><span class="id" type="definition">leb</span></a> <span class="id" type="var">n<sub>1</sub></span> <span class="id" type="var">n<sub>2</sub></span> <span class="id" type="keyword">then</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BTrue"><span class="id" type="constructor">BTrue</span></a> <span class="id" type="keyword">else</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BFalse"><span class="id" type="constructor">BFalse</span></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id" type="var">a<sub>1</sub>'</span>, <span class="id" type="var">a<sub>2</sub>'</span>) ⇒<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BLe"><span class="id" type="constructor">BLe</span></a> <span class="id" type="var">a<sub>1</sub>'</span> <span class="id" type="var">a<sub>2</sub>'</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br>
&nbsp;&nbsp;| <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BNot"><span class="id" type="constructor">BNot</span></a> <span class="id" type="var">b<sub>1</sub></span>  ⇒<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#fold_constants_bexp"><span class="id" type="definition">fold_constants_bexp</span></a> <span class="id" type="var">b<sub>1</sub></span>) <span class="id" type="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BTrue"><span class="id" type="constructor">BTrue</span></a> ⇒ <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BFalse"><span class="id" type="constructor">BFalse</span></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BFalse"><span class="id" type="constructor">BFalse</span></a> ⇒ <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BTrue"><span class="id" type="constructor">BTrue</span></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">b<sub>1</sub>'</span> ⇒ <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BNot"><span class="id" type="constructor">BNot</span></a> <span class="id" type="var">b<sub>1</sub>'</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br>
&nbsp;&nbsp;| <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BAnd"><span class="id" type="constructor">BAnd</span></a> <span class="id" type="var">b<sub>1</sub></span> <span class="id" type="var">b<sub>2</sub></span>  ⇒<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#fold_constants_bexp"><span class="id" type="definition">fold_constants_bexp</span></a> <span class="id" type="var">b<sub>1</sub></span>, <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#fold_constants_bexp"><span class="id" type="definition">fold_constants_bexp</span></a> <span class="id" type="var">b<sub>2</sub></span>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;| (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BTrue"><span class="id" type="constructor">BTrue</span></a>, <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BTrue"><span class="id" type="constructor">BTrue</span></a>) ⇒ <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BTrue"><span class="id" type="constructor">BTrue</span></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;| (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BTrue"><span class="id" type="constructor">BTrue</span></a>, <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BFalse"><span class="id" type="constructor">BFalse</span></a>) ⇒ <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BFalse"><span class="id" type="constructor">BFalse</span></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;| (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BFalse"><span class="id" type="constructor">BFalse</span></a>, <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BTrue"><span class="id" type="constructor">BTrue</span></a>) ⇒ <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BFalse"><span class="id" type="constructor">BFalse</span></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;| (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BFalse"><span class="id" type="constructor">BFalse</span></a>, <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BFalse"><span class="id" type="constructor">BFalse</span></a>) ⇒ <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BFalse"><span class="id" type="constructor">BFalse</span></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id" type="var">b<sub>1</sub>'</span>, <span class="id" type="var">b<sub>2</sub>'</span>) ⇒ <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BAnd"><span class="id" type="constructor">BAnd</span></a> <span class="id" type="var">b<sub>1</sub>'</span> <span class="id" type="var">b<sub>2</sub>'</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br>

<br>
<span class="id" type="keyword">Example</span> <a name="fold_bexp_ex&lt;sub&gt;1&lt;/sub&gt;"><span class="id" type="definition">fold_bexp_ex<sub>1</sub></span></a> :<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#fold_constants_bexp"><span class="id" type="definition">fold_constants_bexp</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BAnd"><span class="id" type="constructor">BAnd</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BTrue"><span class="id" type="constructor">BTrue</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BNot"><span class="id" type="constructor">BNot</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BAnd"><span class="id" type="constructor">BAnd</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BFalse"><span class="id" type="constructor">BFalse</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BTrue"><span class="id" type="constructor">BTrue</span></a>)))<br>
&nbsp;&nbsp;= <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BTrue"><span class="id" type="constructor">BTrue</span></a>.<br>
<div class="togglescript" id="proofcontrol20" onclick="toggleDisplay(&#39;proof20&#39;);toggleDisplay(&#39;proofcontrol20&#39;)"><span class="show"></span></div>
<div class="proofscript" id="proof20" onclick="toggleDisplay(&#39;proof20&#39;);toggleDisplay(&#39;proofcontrol20&#39;)">
<span class="id" type="keyword">Proof</span>. <span class="id" type="tactic">reflexivity</span>. <span class="id" type="keyword">Qed</span>.<br>
</div>

<br>
<span class="id" type="keyword">Example</span> <a name="fold_bexp_ex&lt;sub&gt;2&lt;/sub&gt;"><span class="id" type="definition">fold_bexp_ex<sub>2</sub></span></a> :<br>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#fold_constants_bexp"><span class="id" type="definition">fold_constants_bexp</span></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BAnd"><span class="id" type="constructor">BAnd</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BEq"><span class="id" type="constructor">BEq</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AId"><span class="id" type="constructor">AId</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#X"><span class="id" type="definition">X</span></a>) (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AId"><span class="id" type="constructor">AId</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#Y"><span class="id" type="definition">Y</span></a>))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BEq"><span class="id" type="constructor">BEq</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> 0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AMinus"><span class="id" type="constructor">AMinus</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> 2) (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#APlus"><span class="id" type="constructor">APlus</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> 1)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> 1)))))<br>
&nbsp;&nbsp;= <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BAnd"><span class="id" type="constructor">BAnd</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BEq"><span class="id" type="constructor">BEq</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AId"><span class="id" type="constructor">AId</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#X"><span class="id" type="definition">X</span></a>) (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AId"><span class="id" type="constructor">AId</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#Y"><span class="id" type="definition">Y</span></a>)) <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BTrue"><span class="id" type="constructor">BTrue</span></a>.<br>
<div class="togglescript" id="proofcontrol21" onclick="toggleDisplay(&#39;proof21&#39;);toggleDisplay(&#39;proofcontrol21&#39;)"><span class="show"></span></div>
<div class="proofscript" id="proof21" onclick="toggleDisplay(&#39;proof21&#39;);toggleDisplay(&#39;proofcontrol21&#39;)">
<span class="id" type="keyword">Proof</span>. <span class="id" type="tactic">reflexivity</span>. <span class="id" type="keyword">Qed</span>.<br>
</div>

<br>
</div>

<div class="doc">
To fold constants in a command, we apply the appropriate folding
    functions on all embedded expressions. 
</div>
<div class="code code-tight">

<br>
<span class="id" type="keyword">Fixpoint</span> <a name="fold_constants_com"><span class="id" type="definition">fold_constants_com</span></a> (<span class="id" type="var">c</span> : <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#com"><span class="id" type="inductive">com</span></a>) : <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#com"><span class="id" type="inductive">com</span></a> :=<br>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c"><span class="id" type="variable">c</span></a> <span class="id" type="keyword">with</span><br>
&nbsp;&nbsp;| <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#::'SKIP'"><span class="id" type="notation">SKIP</span></a>      ⇒<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#::'SKIP'"><span class="id" type="notation">SKIP</span></a><br>
&nbsp;&nbsp;| <span class="id" type="var">i</span> ::= <span class="id" type="var">a</span>  ⇒<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#CAss"><span class="id" type="constructor">CAss</span></a> <span class="id" type="var">i</span> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#fold_constants_aexp"><span class="id" type="definition">fold_constants_aexp</span></a> <span class="id" type="var">a</span>)<br>
&nbsp;&nbsp;| <span class="id" type="var">c<sub>1</sub></span> ;; <span class="id" type="var">c<sub>2</sub></span>  ⇒<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#fold_constants_com"><span class="id" type="definition">fold_constants_com</span></a> <span class="id" type="var">c<sub>1</sub></span>) ;; (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#fold_constants_com"><span class="id" type="definition">fold_constants_com</span></a> <span class="id" type="var">c<sub>2</sub></span>)<br>
&nbsp;&nbsp;| <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#::'IFB'_x_'THEN'_x_'ELSE'_x_'FI'"><span class="id" type="notation">IFB</span></a> <span class="id" type="var">b</span> <span class="id" type="var">THEN</span> <span class="id" type="var">c<sub>1</sub></span> <span class="id" type="var">ELSE</span> <span class="id" type="var">c<sub>2</sub></span> <span class="id" type="var">FI</span> ⇒<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#fold_constants_bexp"><span class="id" type="definition">fold_constants_bexp</span></a> <span class="id" type="var">b</span> <span class="id" type="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BTrue"><span class="id" type="constructor">BTrue</span></a> ⇒ <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#fold_constants_com"><span class="id" type="definition">fold_constants_com</span></a> <span class="id" type="var">c<sub>1</sub></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BFalse"><span class="id" type="constructor">BFalse</span></a> ⇒ <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#fold_constants_com"><span class="id" type="definition">fold_constants_com</span></a> <span class="id" type="var">c<sub>2</sub></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">b'</span> ⇒ <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#::'IFB'_x_'THEN'_x_'ELSE'_x_'FI'"><span class="id" type="notation">IFB</span></a> <span class="id" type="var">b'</span> <span class="id" type="var">THEN</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#fold_constants_com"><span class="id" type="definition">fold_constants_com</span></a> <span class="id" type="var">c<sub>1</sub></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">ELSE</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#fold_constants_com"><span class="id" type="definition">fold_constants_com</span></a> <span class="id" type="var">c<sub>2</sub></span> <span class="id" type="var">FI</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br>
&nbsp;&nbsp;| <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#::'WHILE'_x_'DO'_x_'END'"><span class="id" type="notation">WHILE</span></a> <span class="id" type="var">b</span> <span class="id" type="var">DO</span> <span class="id" type="var">c</span> <span class="id" type="var">END</span> ⇒<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#fold_constants_bexp"><span class="id" type="definition">fold_constants_bexp</span></a> <span class="id" type="var">b</span> <span class="id" type="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BTrue"><span class="id" type="constructor">BTrue</span></a> ⇒ <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#::'WHILE'_x_'DO'_x_'END'"><span class="id" type="notation">WHILE</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BTrue"><span class="id" type="constructor">BTrue</span></a> <span class="id" type="var">DO</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#::'SKIP'"><span class="id" type="notation">SKIP</span></a> <span class="id" type="var">END</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BFalse"><span class="id" type="constructor">BFalse</span></a> ⇒ <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#::'SKIP'"><span class="id" type="notation">SKIP</span></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">b'</span> ⇒ <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#::'WHILE'_x_'DO'_x_'END'"><span class="id" type="notation">WHILE</span></a> <span class="id" type="var">b'</span> <span class="id" type="var">DO</span> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#fold_constants_com"><span class="id" type="definition">fold_constants_com</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#c"><span class="id" type="variable">c</span></a>) <span class="id" type="var">END</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br>

<br>
<span class="id" type="keyword">Example</span> <a name="fold_com_ex&lt;sub&gt;1&lt;/sub&gt;"><span class="id" type="definition">fold_com_ex<sub>1</sub></span></a> :<br>
&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#fold_constants_com"><span class="id" type="definition">fold_constants_com</span></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Original&nbsp;program:&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#X"><span class="id" type="definition">X</span></a> ::= <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#APlus"><span class="id" type="constructor">APlus</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> 4) (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> 5);;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#Y"><span class="id" type="definition">Y</span></a> ::= <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AMinus"><span class="id" type="constructor">AMinus</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AId"><span class="id" type="constructor">AId</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#X"><span class="id" type="definition">X</span></a>) (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> 3);;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#::'IFB'_x_'THEN'_x_'ELSE'_x_'FI'"><span class="id" type="notation">IFB</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BEq"><span class="id" type="constructor">BEq</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AMinus"><span class="id" type="constructor">AMinus</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AId"><span class="id" type="constructor">AId</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#X"><span class="id" type="definition">X</span></a>) (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AId"><span class="id" type="constructor">AId</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#Y"><span class="id" type="definition">Y</span></a>))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#APlus"><span class="id" type="constructor">APlus</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> 2) (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> 4)) <span class="id" type="var">THEN</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#::'SKIP'"><span class="id" type="notation">SKIP</span></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">ELSE</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#Y"><span class="id" type="definition">Y</span></a> ::= <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> 0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">FI</span>;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#::'IFB'_x_'THEN'_x_'ELSE'_x_'FI'"><span class="id" type="notation">IFB</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BLe"><span class="id" type="constructor">BLe</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> 0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AMinus"><span class="id" type="constructor">AMinus</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> 4) (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#APlus"><span class="id" type="constructor">APlus</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> 2) (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> 1))) <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">THEN</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#Y"><span class="id" type="definition">Y</span></a> ::= <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> 0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">ELSE</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#::'SKIP'"><span class="id" type="notation">SKIP</span></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">FI</span>;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#::'WHILE'_x_'DO'_x_'END'"><span class="id" type="notation">WHILE</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BEq"><span class="id" type="constructor">BEq</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AId"><span class="id" type="constructor">AId</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#Y"><span class="id" type="definition">Y</span></a>) (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> 0) <span class="id" type="var">DO</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#X"><span class="id" type="definition">X</span></a> ::= <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#APlus"><span class="id" type="constructor">APlus</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AId"><span class="id" type="constructor">AId</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#X"><span class="id" type="definition">X</span></a>) (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> 1)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">END</span>)<br>
&nbsp;&nbsp;= <span class="comment">(*&nbsp;After&nbsp;constant&nbsp;folding:&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#X"><span class="id" type="definition">X</span></a> ::= <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> 9;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#Y"><span class="id" type="definition">Y</span></a> ::= <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AMinus"><span class="id" type="constructor">AMinus</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AId"><span class="id" type="constructor">AId</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#X"><span class="id" type="definition">X</span></a>) (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> 3);;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#::'IFB'_x_'THEN'_x_'ELSE'_x_'FI'"><span class="id" type="notation">IFB</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BEq"><span class="id" type="constructor">BEq</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AMinus"><span class="id" type="constructor">AMinus</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AId"><span class="id" type="constructor">AId</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#X"><span class="id" type="definition">X</span></a>) (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AId"><span class="id" type="constructor">AId</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#Y"><span class="id" type="definition">Y</span></a>)) (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> 6) <span class="id" type="var">THEN</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#::'SKIP'"><span class="id" type="notation">SKIP</span></a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">ELSE</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#Y"><span class="id" type="definition">Y</span></a> ::= <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> 0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">FI</span>;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#Y"><span class="id" type="definition">Y</span></a> ::= <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> 0;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#::'WHILE'_x_'DO'_x_'END'"><span class="id" type="notation">WHILE</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#BEq"><span class="id" type="constructor">BEq</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AId"><span class="id" type="constructor">AId</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#Y"><span class="id" type="definition">Y</span></a>) (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> 0) <span class="id" type="var">DO</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#X"><span class="id" type="definition">X</span></a> ::= <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#APlus"><span class="id" type="constructor">APlus</span></a> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#AId"><span class="id" type="constructor">AId</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#X"><span class="id" type="definition">X</span></a>) (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Imp.html#ANum"><span class="id" type="constructor">ANum</span></a> 1)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">END</span>).<br>
<div class="togglescript" id="proofcontrol22" onclick="toggleDisplay(&#39;proof22&#39;);toggleDisplay(&#39;proofcontrol22&#39;)"><span class="show"></span></div>
<div class="proofscript" id="proof22" onclick="toggleDisplay(&#39;proof22&#39;);toggleDisplay(&#39;proofcontrol22&#39;)">
<span class="id" type="keyword">Proof</span>. <span class="id" type="tactic">reflexivity</span>. <span class="id" type="keyword">Qed</span>.<br>
</div>

<br>
</div>

<div class="doc">
<a name="lab383"></a><h2 class="section">Soundness of Constant Folding</h2>

<div class="paragraph"> </div>

 Now we need to show that what we've done is correct. 
<div class="paragraph"> </div>

 Here's the proof for arithmetic expressions: 
</div>
<div class="code code-tight">

<br>
<span class="id" type="keyword">Theorem</span> <a name="fold_constants_aexp_sound"><span class="id" type="lemma">fold_constants_aexp_sound</span></a> :<br>
&nbsp;&nbsp;<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#atrans_sound"><span class="id" type="definition">atrans_sound</span></a> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#fold_constants_aexp"><span class="id" type="definition">fold_constants_aexp</span></a>.<br>
<div class="togglescript" id="proofcontrol23" onclick="toggleDisplay(&#39;proof23&#39;);toggleDisplay(&#39;proofcontrol23&#39;)"><span class="show"></span></div>
<div class="proofscript" id="proof23" onclick="toggleDisplay(&#39;proof23&#39;);toggleDisplay(&#39;proofcontrol23&#39;)">
<span class="id" type="keyword">Proof</span>.<br>
&nbsp;&nbsp;<span class="id" type="tactic">unfold</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#atrans_sound"><span class="id" type="definition">atrans_sound</span></a>. <span class="id" type="tactic">intros</span> <span class="id" type="var">a</span>. <span class="id" type="tactic">unfold</span> <a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#aequiv"><span class="id" type="definition">aequiv</span></a>. <span class="id" type="tactic">intros</span> <span class="id" type="var">st</span>.<br>
&nbsp;&nbsp;<span class="id" type="tactic">induction</span> <span class="id" type="var">a</span>; <span class="id" type="tactic">simpl</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;ANum&nbsp;and&nbsp;AId&nbsp;follow&nbsp;immediately&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">try</span> <span class="id" type="tactic">reflexivity</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;APlus,&nbsp;AMinus,&nbsp;and&nbsp;AMult&nbsp;follow&nbsp;from&nbsp;the&nbsp;IH<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;the&nbsp;observation&nbsp;that<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aeval&nbsp;st&nbsp;(APlus&nbsp;a<sub>1</sub>&nbsp;a<sub>2</sub>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ANum&nbsp;((aeval&nbsp;st&nbsp;a<sub>1</sub>)&nbsp;+&nbsp;(aeval&nbsp;st&nbsp;a<sub>2</sub>))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;aeval&nbsp;st&nbsp;(ANum&nbsp;((aeval&nbsp;st&nbsp;a<sub>1</sub>)&nbsp;+&nbsp;(aeval&nbsp;st&nbsp;a<sub>2</sub>)))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(and&nbsp;similarly&nbsp;for&nbsp;AMinus/minus&nbsp;and&nbsp;AMult/mult)&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">try</span> (<span class="id" type="tactic">destruct</span> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#fold_constants_aexp"><span class="id" type="definition">fold_constants_aexp</span></a> <span class="id" type="var">a<sub>1</sub></span>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> (<a class="idref" href="http://www.seas.upenn.edu/~cis500/current/sf/Equiv.html#fold_constants_aexp"><span class="id" type="definition">fold_constants_aexp</span></a> <span class="id" type="var">a<sub>2</sub></span>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">IHa1</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">IHa2</span>; <span class="id" type="tactic">reflexivity</span>). <span class="id" type="keyword">Qed</span>.<br>
</div>

<br>
</div>

<div class="doc">
<a name="lab384"></a><h4 class="section">Exercise: 3 stars, optional (fold_bexp_Eq_informal)</h4>
 Here is an informal proof of the <span class="inlinecode"><span class="id" type="var">BEq</span></span> case of the soundness
    argument for boolean expression constant folding.  Read it
    carefully and compare it to the formal proof that follows.  Then
    fill in the <span class="inlinecode"><span class="id" type="var">BLe</span></span> case of the formal proof (without looking at the
    <span class="inlinecode"><span class="id" type="var">BEq</span></span> case, if possible).

<div class="paragraph"> </div>

   <i>Theorem</i>: The constant folding function for booleans,
   <span class="inlinecode"><span class="id" type="var">fold_constants_bexp</span></span>, is sound.

<div class="paragraph"> </div>

   <i>Proof</i>: We must show that <span class="inlinecode"><span class="id" type="var">b</span></span> is equivalent to <span class="inlinecode"><span class="id" type="var">fold_constants_bexp</span></span>,
   for all boolean expressions <span class="inlinecode"><span class="id" type="var">b</span></span>.  Proceed by induction on <span class="inlinecode"><span class="id" type="var">b</span></span>.  We
   show just the case where <span class="inlinecode"><span class="id" type="var">b</span></span> has the form <span class="inlinecode"><span class="id" type="var">BEq</span></span> <span class="inlinecode"><span class="id" type="var">a<sub>1</sub></span></span> <span class="inlinecode"><span class="id" type="var">a<sub>2</sub></span></span>.

<div class="paragraph"> </div>

   In this case, we must show

<div class="paragraph"> </div>

<div class="code code-tight">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">beval</span>&nbsp;<span class="id" type="var">st</span>&nbsp;(<span class="id" type="var">BEq</span>&nbsp;<span class="id" type="var">a<sub>1</sub></span>&nbsp;<span class="id" type="var">a<sub>2</sub></span>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;<span class="id" type="var">beval</span>&nbsp;<span class="id" type="var">st</span>&nbsp;(<span class="id" type="var">fold_constants_bexp</span>&nbsp;(<span class="id" type="var">BEq</span>&nbsp;<span class="id" type="var">a<sub>1</sub></span>&nbsp;<span class="id" type="var">a<sub>2</sub></span>)).
<div class="paragraph"> </div>

</div>
   There are two cases to consider:

<div class="paragraph"> </div>

<ul class="doclist">
<li> First, suppose <span class="inlinecode"><span class="id" type="var">fold_constants_aexp</span></span> <span class="inlinecode"><span class="id" type="var">a<sub>1</sub></span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" type="var">ANum</span></span> <span class="inlinecode"><span class="id" type="var">n<sub>1</sub></span></span> and
       <span class="inlinecode"><span class="id" type="var">fold_constants_aexp</span></span> <span class="inlinecode"><span class="id" type="var">a<sub>2</sub></span></span></li></ul></div></div></div><audio controls="controls" style="display: none;"></audio></body><style type="text/css">#yddContainer{display:block;font-family:Microsoft YaHei;position:relative;width:100%;height:100%;top:-4px;left:-4px;font-size:12px;border:1px solid}#yddTop{display:block;height:22px}#yddTopBorderlr{display:block;position:static;height:17px;padding:2px 28px;line-height:17px;font-size:12px;color:#5079bb;font-weight:bold;border-style:none solid;border-width:1px}#yddTopBorderlr .ydd-sp{position:absolute;top:2px;height:0;overflow:hidden}.ydd-icon{left:5px;width:17px;padding:0px 0px 0px 0px;padding-top:17px;background-position:-16px -44px}.ydd-close{right:5px;width:16px;padding-top:16px;background-position:left -44px}#yddKeyTitle{float:left;text-decoration:none}#yddMiddle{display:block;margin-bottom:10px}.ydd-tabs{display:block;margin:5px 0;padding:0 5px;height:18px;border-bottom:1px solid}.ydd-tab{display:block;float:left;height:18px;margin:0 5px -1px 0;padding:0 4px;line-height:18px;border:1px solid;border-bottom:none}.ydd-trans-container{display:block;line-height:160%}.ydd-trans-container a{text-decoration:none;}#yddBottom{position:absolute;bottom:0;left:0;width:100%;height:22px;line-height:22px;overflow:hidden;background-position:left -22px}.ydd-padding010{padding:0 10px}#yddWrapper{color:#252525;z-index:10001;background:url(chrome-extension://eopjamdnofihpioajgfdikhhbobonhbb/ab20.png);}#yddContainer{background:#fff;border-color:#4b7598}#yddTopBorderlr{border-color:#f0f8fc}#yddWrapper .ydd-sp{background-image:url(chrome-extension://eopjamdnofihpioajgfdikhhbobonhbb/ydd-sprite.png)}#yddWrapper a,#yddWrapper a:hover,#yddWrapper a:visited{color:#50799b}#yddWrapper .ydd-tabs{color:#959595}.ydd-tabs,.ydd-tab{background:#fff;border-color:#d5e7f3}#yddBottom{color:#363636}#yddWrapper{min-width:250px;max-width:400px;}</style></html>